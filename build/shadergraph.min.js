!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ShaderGraph",[],e):"object"==typeof exports?exports.ShaderGraph=e():t.ShaderGraph=e()}(self,(function(){return(()=>{var t={960:(t,e,n)=>{var s=n(565);t.exports=function(t){for(var e=s(),n=0;n<t.length;n++)e(t[n]);return e(null)}},559:t=>{let e,n,s,r;const i={nud:function(){return this.children&&this.children.length?this:y("unexpected")()},led:y("missing operator")},o={};function a(){return this}function h(t,e){let n=o[t];return e=e||0,n?e>n.lbp&&(n.lbp=e):(n=Object.create(i),n.id=t,n.lbp=e,o[t]=n),n}function u(t){let e,s=n;for(m(),e=s.nud();t<n.lbp;)s=n,m(),e=s.led(e);return e}function l(t,e,n){h(t,e).led=n||function(t){return this.children=[t,u(e)],this.type="binary",this}}function c(t,e,n){const s=h(t,e);return s.led=n||function(t){return this.children=[t,u(e-1)],this.type="binary",this},s}function p(t,e){const n=h(t);return n.nud=e||function(){return this.children=[u(70)],this.type="unary",this},n}function d(t){h(t,150).led=function(t){return this.children=[t],this.type="suffix",this}}function f(t){return c(t,10,(function(t){return this.children=[t,u(9)],this.assignment=!0,this.type="assign",this}))}function m(t){let i,h,u,l;if(t&&n.data!==t)return e.unexpected("expected `"+t+"`, got `"+n.data+"`");if(!(r>=s.length)){if(i=s[r++],h=i.data,u=i.type,"ident"===u)l=e.scope.find(h)||e.create_node(),u=l.type;else if("builtin"===u)l=o["(builtin)"];else if("keyword"===u)l=o["(keyword)"];else if("operator"===u){if(l=o[h],!l)return e.unexpected("unknown operator `"+h+"`")}else{if("float"!==u&&"integer"!==u)return e.unexpected("unexpected token.");u="literal",l=o["(literal)"]}return l&&(l.nud||(l.nud=a),l.children||(l.children=[])),l=Object.create(l),l.token=i,l.type=u,l.data||(l.data=h),n=l}n=o["(end)"]}function y(t){return function(){return e.unexpected(t)}}h("(ident)").nud=a,h("(keyword)").nud=a,h("(builtin)").nud=a,h("(literal)").nud=a,h("(end)"),h(":"),h(";"),h(","),h(")"),h("]"),h("}"),c("&&",30),c("||",30),l("|",43),l("^",44),l("&",45),l("==",46),l("!=",46),l("<",47),l("<=",47),l(">",47),l(">=",47),l(">>",48),l("<<",48),l("+",50),l("-",50),l("*",60),l("/",60),l("%",60),l("?",20,(function(t){return this.children=[t,u(0),(m(":"),u(0))],this.type="ternary",this})),l(".",80,(function(t){return n.type="literal",e.fake(n),this.children=[t,n],m(),this})),l("[",80,(function(t){return this.children=[t,u(0)],this.type="binary",m("]"),this})),l("(",80,(function(t){if(this.children=[t],this.type="call",")"!==n.data)for(;this.children.push(u(0)),","===n.data;)m(",");return m(")"),this})),p("-"),p("+"),p("!"),p("~"),p("defined"),p("(",(function(){return this.type="group",this.children=[u(0)],m(")"),this})),p("++"),p("--"),d("++"),d("--"),f("="),f("+="),f("-="),f("*="),f("/="),f("%="),f("&="),f("|="),f("^="),f(">>="),f("<<="),t.exports=function(t,n){let i;if(e=t,s=n,r=0,s.length){if(m(),i=u(0),i.parent=e[0],function t(n){e.unshift(n,!1);for(let e=0,s=n.children.length;e<s;++e)t(n.children[e]);e.shift()}(i),r<s.length)throw new Error("did not use all tokens");i.parent.children=[i]}}},565:(t,e,n)=>{t.exports=function(){const t=Ct(u),e=Ct(h),n=Ct(f),o=Ct(_),w=Ct(a),M=(Ct(v),Ct(c)),F=Ct(p),L=Ct(m),R=Ct(g),I=Ct(y),$=Ct(z),U=Ct(S),B=Ct(T);let H,N,X,Z,G,Q,Y,W,J,K,tt,et,nt,st=arguments.length?[].slice.call(arguments):[],rt=!1,it=!1,ot=[],at=[],ht=[],ut=[],lt=!1;return ot.shift=gt,ot.unshift=yt,ot.fake=mt,ot.unexpected=Ft,ot.scope=new r(ot),ot.create_node=function(){const t=D(a,et);return t.parent=ct.program,t},Bt(),nt=t(),nt.expecting="(eof)",nt.mode=u,nt.token={type:"(program)",data:"(program)"},tt=nt,ct.program=tt,ct.scope=function(t){return 1===arguments.length&&(ot.scope=t),ot.scope},ot.unshift(nt),ct;function ct(t){return null===t?(dt(),tt):(at=[],pt(t),at)}function pt(t){if("whitespace"!==t.type&&"line-comment"!==t.type&&"block-comment"!==t.type)for(ht.push(t),et=et||ht[0],et&&ut.length&&(et.preceding=et.preceding||[],et.preceding=et.preceding.concat(ut),ut=[]);ft();)switch(ot[0].mode){case h:_t();break;case u:xt();break;case d:Mt();break;case f:bt();break;case x:At();break;case l:H(!0,!0);break;case _:N();break;case a:kt();break;case b:zt();break;case v:vt();break;case c:J();break;case p:K();break;case m:Z();break;case y:Y();break;case S:W();break;case z:Q();break;case g:G();break;case T:X()}else ut.push(t)}function dt(t){arguments.length&&pt(t),ot.length>1?Ft("unexpected EOF"):rt=!0}function ft(){return!(lt||!ot.length)&&(et=ht[0])}function mt(t){ot.unshift(t),ot.shift()}function yt(t,e){t.parent=ot[0];const n=[].unshift.call(this,t);return(e=void 0===e||e)&&nt!==t&&nt.children.push(t),nt=t,n}function gt(){let t=[].shift.call(this),e=st[this.length],n=!1;return st.length?"function"==typeof st[0]?n=st[0](t):void 0!==e&&(n=e.test?e.test(t.type):e===t.type):n=!0,n&&!lt&&at.push(t),nt=t.parent,t}function xt(){return Ot((function(){return ot.scope.enter(),i}),(function(){if(et.data===ot[0].expecting)return ot.scope.exit(),ot.shift();switch(et.type){case"preprocessor":return ot.fake(St()),void ht.shift();default:return void ot.unshift(e())}}))()}function _t(){if(ot[0].brace)return"}"!==et.data?Ft("expected `}`, got "+et.data):(ot[0].brace=!1,ht.shift(),ot.shift());switch(et.type){case"eof":return wt();case"keyword":switch(et.data){case"for":return ot.unshift(L());case"if":return ot.unshift(R());case"while":return ot.unshift(I());case"do":return ot.unshift(U());case"break":return ot.fake(D(k,et)),ht.shift();case"continue":return ot.fake(D(A,et)),ht.shift();case"discard":return ot.fake(D(C,et)),ht.shift();case"return":return ot.unshift($());case"precision":return ot.unshift(o())}return ot.unshift(Et(V));case"ident":var e;if(e=ot.scope.find(et.data))return"struct"===e.parent.type?ot.unshift(Et(V)):ot.unshift(Vt(";"));case"operator":if("{"===et.data){ot[0].brace=!0;const e=t();return e.expecting="}",ht.shift(),ot.unshift(e)}if(";"===et.data)return ht.shift(),ot.shift();default:return ot.unshift(Vt(";"))}}function wt(){return it&&(lt=!0),it=!0,ot.shift()}function Mt(){const t=ot[0];return Ot((function(){return"invariant"===et.data?8&t.flags?(ot.unshift(jt()),i):Ft("`invariant` is not allowed here"):(ot.fake(D(E,{data:"",position:et.position})),i)}),(function(){return P(et)?16&t.flags?(ot.unshift(jt()),i):Ft("storage is not allowed here"):(ot.fake(D(E,{data:"",position:et.position})),i)}),(function(){return O(et)?32&t.flags?Ft("parameter is not allowed here"):(ot.unshift(jt()),i):(ot.fake(D(E,{data:"",position:et.position})),i)}),(function(){return q(et)?(ot.unshift(jt()),i):(ot.fake(D(E,{data:"",position:et.position})),i)}),(function(){if("struct"===et.data)return 64&t.flags?(ot.unshift(Tt()),i):Ft("cannot nest structs");if("keyword"===et.type)return ot.unshift(jt()),i;const e=ot.scope.find(et.data);if(e)return ot.fake(Object.create(e)),ht.shift(),i;return Ft("expected user defined type, struct or keyword, got "+et.data)}),(function(){if(","===et.data&&!(2&t.flags))return ot.shift();if("["===et.data)return void ot.unshift(B());if(")"===et.data)return ot.shift();if(";"===et.data)return t.stage+3;if("ident"!==et.type&&"builtin"!==et.type)return Ft("expected identifier, got "+et.data);return t.collected_name=ht.shift(),i}),(function(){if("("===et.data)return ht.unshift(t.collected_name),delete t.collected_name,ot.unshift(M()),t.stage+2;return i}),(function(){return ht.unshift(t.collected_name),delete t.collected_name,ot.unshift(n()),i}),(function(){return ot.shift()}))()}function bt(){if("ident"===et.type||"builtin"===et.type){const t=et.data;return ot.unshift(w()),void ot.scope.define(t)}if("operator"===et.type){if(","===et.data)return 2&ot[1].flags?ht.shift():ot.shift();if("="===et.data)return 1&ot[1].flags?(ht.shift(),void ot.unshift(Vt(",",";"))):Ft("`=` is not allowed here.");if("["===et.data)return void ot.unshift(B())}return ot.shift()}function vt(){return"keyword"===et.type?(ot[0].type="keyword",void(ot[0].mode=b)):"ident"===et.type?(ot[0].type="ident",void(ot[0].mode=a)):Ft("expected keyword or user-defined name, got "+et.data)}function zt(){return"keyword"!==et.type?Ft("expected keyword, got "+et.data):(ot.shift(),ht.shift())}function kt(){return"ident"!==et.type&&"builtin"!==et.type?Ft("expected user-defined name, got "+et.data):(ot[0].data=et.data,ot.shift(),ht.shift())}function At(){const t=ot[0].expecting;if(ot[0].tokens=ot[0].tokens||[],void 0===ot[0].parenlevel&&(ot[0].parenlevel=0,ot[0].bracelevel=0),ot[0].parenlevel<1&&t.indexOf(et.data)>-1)return function(t){try{s(ot,t)}catch(t){throw lt=!0,t}return ot.shift()}(ot[0].tokens);switch("("===et.data?++ot[0].parenlevel:")"===et.data&&--ot[0].parenlevel,et.data){case"{":++ot[0].bracelevel;break;case"}":--ot[0].bracelevel;break;case"(":++ot[0].parenlevel;break;case")":--ot[0].parenlevel}return ot[0].parenlevel<0?Ft("unexpected `)`"):ot[0].bracelevel<0?Ft("unexpected `}`"):void ot[0].tokens.push(ht.shift())}function Ct(t){return function(){return D(t,et)}}function St(){return D(j[et.type],et)}function Et(t){const e=D(d,et);return e.flags=t,e}function Tt(t,e){const n=D(l,et);return n.allow_assign=void 0===t||t,n.allow_comma=void 0===e||e,n}function Vt(){const t=D(x,et);return t.expecting=[].slice.call(arguments),t}function jt(t){let e=et;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),D(b,e)}function Ft(t){throw lt=!0,new Error((t||"unexpected "+ot)+" at line "+ot[0].token.line)}function Dt(t,e){return Pt(t,et.type)&&Pt(e,et.data)}function Pt(t,e){switch(typeof t){case"string":return e!==t&&Ft("expected `"+t+"`, got "+e+"\n"+et.data),!lt;case"object":return t&&-1===t.indexOf(e)&&Ft("expected one of `"+t.join("`, `")+"`, got "+e),!lt}return!0}function Ot(){let t,e,n=[].slice.call(arguments);return function(){const s=ot[0];return s.stage||(s.stage=0),t=n[s.stage],t?(e=t(),e===i?++s.stage:void(void 0!==e&&(s.stage=e))):Ft("parser in undefined state!")}}function qt(t,e){return e=e||"operator",function(){if(!Dt(e,t))return;const n=ht.shift(),s=ot[0].children,r=s[s.length-1];return r&&r.token&&n.preceding&&(r.token.succeeding=r.token.succeeding||[],r.token.succeeding=r.token.succeeding.concat(n.preceding)),i}}function Lt(t){return function(){return ot.unshift(Vt(t)),i}}function Rt(t){return t?function(){const t=et.data;return Dt("ident")&&(ot.unshift(w()),ot.scope.define(t),i)}:function(){if(!Dt("ident"))return;return Object.create(ot.scope.find(et.data)).token=et,ht.shift(),i}}function It(){return function(){const e=t();return e.expecting="}",ot.unshift(e),i}}function $t(t){return function(){const n=ot[0].stage;return"{"!==et.data?(ot.unshift(e()),n+t):(ht.shift(),i)}}function Ut(){return function(){return ot.shift(),ot.shift()}}function Bt(){H=Ot(qt("struct","keyword"),(function(){return"{"===et.data?(ot.fake(D(a,{data:"",position:et.position,type:"ident"})),i):Rt(!0)()}),(function(){return ot.scope.enter(),i}),qt("{"),(function(){return"preprocessor"===et.type?(ot.fake(St()),void ht.shift()):"}"===et.data?(ot.scope.exit(),ht.shift(),ot.shift()):void(";"!==et.data?ot.unshift(Et(166)):ht.shift())})),N=Ot((function(){return ht.shift(),i}),(function(){return Dt("keyword",["lowp","mediump","highp"])&&(ot.unshift(jt()),i)}),(function(){return ot.unshift(jt()),i}),(function(){return ot.shift()})),X=Ot(qt("["),Lt("]"),qt("]"),(function(){return ot.shift()})),Z=Ot(qt("for","keyword"),qt("("),(function(){let t;if("ident"===et.type){if((t=ot.scope.find(et.data))||(t=ot.create_node()),"struct"===t.parent.type)return ot.unshift(Et(V)),i}else if("builtin"===et.type||"keyword"===et.type)return ot.unshift(Et(V)),i;return Lt(";")()}),qt(";"),Lt(";"),qt(";"),Lt(")"),qt(")"),$t(3),It(),qt("}"),Ut()),G=Ot(qt("if","keyword"),qt("("),Lt(")"),qt(")"),$t(3),It(),qt("}"),(function(){return"else"===et.data?(ht.shift(),ot.unshift(e()),i):Ut()()}),Ut()),Q=Ot(qt("return","keyword"),(function(){return";"===et.data||ot.unshift(Vt(";")),i}),(function(){ht.shift(),Ut()()})),Y=Ot(qt("while","keyword"),qt("("),Lt(")"),qt(")"),$t(3),It(),qt("}"),Ut()),W=Ot(qt("do","keyword"),$t(3),It(),qt("}"),qt("while","keyword"),qt("("),Lt(")"),qt(")"),Ut()),J=Ot((function(){for(let t=1,e=ot.length;t<e;++t)if(ot[t].mode===c)return Ft("function definition is not allowed within another function");return i}),(function(){if(!Dt("ident"))return;const t=et.data,e=ot.scope.find(t);return ot.unshift(w()),ot.scope.define(t),ot.scope.enter(e?e.scope:null),i}),qt("("),(function(){return ot.unshift(F()),i}),qt(")"),(function(){return";"===et.data?(ot.scope.exit(),ot.shift(),ot.shift()):i}),qt("{"),It(),qt("}"),(function(){return ot.scope.exit(),i}),(function(){return ot.shift(),ot.shift(),ot.shift()})),K=Ot((function(){return"void"===et.data?(ot.fake(jt()),ht.shift(),i):")"!==et.data?"struct"===et.data?(ot.unshift(Tt(false,false)),i):(ot.unshift(Et(208)),i):void ot.shift()}),(function(){if(","===et.data)return ht.shift(),0;")"!==et.data?Ft("expected one of `,` or `)`, got "+et.data):ot.shift()}))}};const s=n(559),r=n(669),i=new Object;let o=0,a=o++,h=o++,u=o++,l=o++,c=o++,p=o++,d=o++,f=o++,m=o++,y=o++,g=o++,x=o++,_=o++,w=o++,M=o++,b=o++,v=o++,z=o++,k=o++,A=o++,C=o++,S=o++,E=o++,T=o++;const V=255,j={"block-comment":w,"line-comment":w,preprocessor:M},F=o=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"];function D(t,e){return{mode:t,token:e,children:[],type:F[t],id:(4294967295*Math.random()).toString(16)}}function P(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function O(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function q(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}},669:t=>{function e(t){if(this.constructor!==e)return new e(t);this.state=t,this.scopes=[],this.current=null}t.exports=e;const n=e.prototype;n.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},n.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},n.define=function(t){this.current[t]=this.state[0]},n.find=function(t,e){for(let e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(t))return this.scopes[e][t];return null}},460:(t,e,n)=>{t.exports=function(t){var e,n,c,p=0,d=0,f=h,m=[],y=[],g=1,x=0,_=0,w=!1,M=!1,b="",v=i,z=s;"300 es"===(t=t||{}).version&&(v=a,z=o);var k={},A={};for(p=0;p<v.length;p++)k[v[p]]=!0;for(p=0;p<z.length;p++)A[z[p]]=!0;return function(t){return y=[],null!==t?function(t){p=0,t.toString&&(t=t.toString());var n;b+=t.replace(/\r\n/g,"\n"),c=b.length;for(;e=b[p],p<c;){switch(n=p,f){case 0:p=j();break;case 1:p=V();break;case 2:p=T();break;case 3:p=F();break;case 4:p=O();break;case 11:p=P();break;case 5:p=q();break;case u:p=L();break;case 9:p=E();break;case h:p=S()}if(n!==p)switch(b[n]){case"\n":x=0,++g;break;default:++x}}return d+=p,b=b.slice(p),y}(t):function(t){m.length&&C(m.join(""));return f=10,C("(eof)"),y}()};function C(t){t.length&&y.push({type:l[f],data:t,position:_,line:g,column:x})}function S(){return m=m.length?[]:m,"/"===n&&"*"===e?(_=d+p-1,f=0,n=e,p+1):"/"===n&&"/"===e?(_=d+p-1,f=1,n=e,p+1):"#"===e?(f=2,_=d+p,p):/\s/.test(e)?(f=9,_=d+p,p):(w=/\d/.test(e),M=/[^\w_]/.test(e),_=d+p,f=w?4:M?3:u,p)}function E(){return/[^\s]/g.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function T(){return"\r"!==e&&"\n"!==e||"\\"===n?(m.push(e),n=e,p+1):(C(m.join("")),f=h,p)}function V(){return T()}function j(){return"/"===e&&"*"===n?(m.push(e),C(m.join("")),f=h,p+1):(m.push(e),n=e,p+1)}function F(){if("."===n&&/\d/.test(e))return f=5,p;if("/"===n&&"*"===e)return f=0,p;if("/"===n&&"/"===e)return f=1,p;if("."===e&&m.length){for(;D(m););return f=5,p}if(";"===e||")"===e||"("===e){if(m.length)for(;D(m););return C(e),f=h,p+1}var t=2===m.length&&"="!==e;if(/[\w_\d\s]/.test(e)||t){for(;D(m););return f=h,p}return m.push(e),n=e,p+1}function D(t){for(var e,n,s=0;;){if(e=r.indexOf(t.slice(0,t.length+s).join("")),n=r[e],-1===e){if(s--+t.length>0)continue;n=t.slice(0,1).join("")}return C(n),_+=n.length,(m=m.slice(n.length)).length}}function P(){return/[^a-fA-F0-9]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function O(){return"."===e||/[eE]/.test(e)?(m.push(e),f=5,n=e,p+1):"x"===e&&1===m.length&&"0"===m[0]?(f=11,m.push(e),n=e,p+1):/[^\d]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function q(){return"f"===e&&(m.push(e),n=e,p+=1),/[eE]/.test(e)?(m.push(e),n=e,p+1):("-"!==e&&"+"!==e||!/[eE]/.test(n))&&/[^\d]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function L(){if(/[^\d\w_]/.test(e)){var t=m.join("");return f=A[t]?8:k[t]?7:6,C(m.join("")),f=h,p}return m.push(e),n=e,p+1}};var s=n(529),r=n(679),i=n(222),o=n(914),a=n(537),h=999,u=9999,l=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},537:(t,e,n)=>{var s=n(222);s=s.slice().filter((function(t){return!/^(gl\_|texture)/.test(t)})),t.exports=s.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},222:t=>{t.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},914:(t,e,n)=>{var s=n(529);t.exports=s.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},529:t=>{t.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},679:t=>{t.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},932:(t,e,n)=>{var s=n(460);t.exports=function(t,e){var n=s(e),r=[];return r=(r=r.concat(n(t))).concat(n(null))}},760:(t,e)=>{e.make=function(t){return null==t&&(t=[]),t instanceof Array||(t=[null!=+t?+t:0]),t},e.nest=(t,e)=>t.concat(e),e.compare=function(t,e){for(let n=0,s=Math.min(t.length,e.length),r=0<=s;r?n<s:n>s;r?n++:n--){const s=t[n],r=e[n];if(s>r)return-1;if(s<r)return 1}return(t=t.length)>(e=e.length)?-1:t<e?1:0},e.max=function(t,n){return e.compare(t,n)>0?n:t}}},e={};function n(s){var r=e[s];if(void 0!==r)return r.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{"use strict";n.r(s),n.d(s,{ShaderGraph:()=>pe,inspect:()=>ue,load:()=>de,visualize:()=>he});var t={};n.r(t),n.d(t,{Graph:()=>h,IN:()=>c,Node:()=>l,OUT:()=>p,Outlet:()=>u});var e={};n.r(e),n.d(e,{Layout:()=>x,Program:()=>y,Snippet:()=>d,assemble:()=>m,compare:()=>f.compare,link:()=>g,load:()=>_,make:()=>f.make,max:()=>f.max,nest:()=>f.nest});var r={};n.r(r),n.d(r,{merge:()=>U,overlay:()=>I,process:()=>F});var i={};n.r(i),n.d(i,{inspect:()=>Q,markup:()=>H,serialize:()=>B,visualize:()=>G});var o={};n.r(o),n.d(o,{Factory:()=>Y,Material:()=>J,cache:()=>et,hash:()=>E,library:()=>K,queue:()=>tt});var a={};n.r(a),n.d(a,{RETURN_ARG:()=>Ft,SHADOW_ARG:()=>jt,body:()=>Gt,build:()=>te,call:()=>Kt,compile:()=>nt,dedupe:()=>re,define:()=>Qt,defuse:()=>se,fn:()=>Yt,hoist:()=>ie,invoke:()=>Wt,lines:()=>Nt,link:()=>ne,links:()=>ee,list:()=>Xt,parse:()=>Pt,same:()=>Jt,statements:()=>Zt,unshadow:()=>Ht,walk:()=>Ut});class h{static initClass(){this.index=0,this.IN=0,this.OUT=1}static id(t){return++h.index}constructor(t,e=null){this.parent=e,this.id=h.id(),this.nodes=[],t&&this.add(t)}inputs(){const t=[];for(const e of Array.from(this.nodes))for(const n of Array.from(e.inputs))null===n.input&&t.push(n);return t}outputs(){const t=[];for(const e of Array.from(this.nodes))for(const n of Array.from(e.outputs))0===n.output.length&&t.push(n);return t}getIn(t){return Array.from(this.inputs()).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs()).filter((e=>e.name===t))[0]}add(t,e){if(t.length)for(const e of Array.from(t))this.add(e);else{if(t.graph&&!e)throw new Error("Adding node to two graphs at once");t.graph=this,this.nodes.push(t)}}remove(t,e){if(t.length)for(const e of Array.from(t))this.remove(e);else{if(t.graph!==this)throw new Error("Removing node from wrong graph.");e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}}adopt(t){if(t.length)for(const e of Array.from(t))this.adopt(e);else t.graph.remove(t,!0),this.add(t,!0)}}h.initClass();class u{static initClass(){this.index=0}static make(t,e){null==e&&(e={});const n=e;if(null!=t.meta)for(const e in t.meta){const s=t.meta[e];n[e]=s}return new u(t.inout,t.name,t.hint,t.type,n)}static id(t){return`_io_${++u.index}_${t}`}static hint(t){return(t=(t=t.replace(/^_io_[0-9]+_/,"")).replace(/_i_o$/,"")).replace(/(In|Out|Inout|InOut)$/,"")}constructor(t,e,n,s,r,i){this.inout=t,this.name=e,this.hint=n,this.type=s,null==r&&(r={}),this.meta=r,this.id=i,null==this.hint&&(this.hint=u.hint(this.name)),this.node=null,this.input=null,this.output=[],null==this.id&&(this.id=u.id(this.hint))}morph(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta}dupe(t){null==t&&(t=this.id);const e=u.make(this);return e.name=t,e}connect(t){if(this.inout===h.IN&&t.inout===h.OUT)return t.connect(this);if(this.inout!==h.OUT||t.inout!==h.IN)throw new Error("Can only connect out to in.");return t.input!==this?(t.disconnect(),t.input=this,this.output.push(t)):void 0}disconnect(t){if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(t of Array.from(this.output))t.input=null;return this.output=[]}{const e=this.output.indexOf(t);if(e>=0)return this.output.splice(e,1),t.input=null}}}}u.initClass();class l{static initClass(){this.index=0}static id(t){return++l.index}constructor(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.all=[],this.outlets=null,this.id=l.id(),this.setOutlets(e)}getIn(t){return Array.from(this.inputs).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs).filter((e=>e.name===t))[0]}get(t){return this.getIn(t)||this.getOut(t)}setOutlets(t){if(null!=t){let e;if(null==this.outlets){for(e of(this.outlets={},Array.from(t)))e instanceof u||(e=u.make(e)),this._add(e);return}const n=t=>[t.name,t.inout,t.type].join("-"),s={};for(e of Array.from(t))s[n(e)]=!0;for(let t in this.outlets)e=this.outlets[t],t=n(e),s[t]?s[t]=e:this._remove(e);for(e of Array.from(t)){const t=s[n(e)];t instanceof u?this._morph(t,e):(e instanceof u||(e=u.make(e)),this._add(e))}}return this.outlets}connect(t,e,n){let s,r,i,o,a;const h={},u={},l=t=>a+"/"+t.hint;for(s of Array.from(t.inputs)){let t;!n&&s.input||(({type:a}=s),i=l(s),u[i]||(u[i]=s),h[a]=t=h[a]||[],t.push(s))}let c=this.outputs;for(o of(c=c.filter((t=>!(e&&t.output.length))),Array.from(c.slice())))({type:a}=o),i=l(o),r=h[a],(s=u[i])&&(o.connect(s),delete u[i],r.splice(r.indexOf(s),1),c.splice(c.indexOf(o),1));if(!c.length)return this;for(o of Array.from(c.slice()))({type:a}=o),r=h[a],r&&r.length&&o.connect(r.shift());return this}disconnect(t){let e;for(e of Array.from(this.inputs))e.disconnect();for(e of Array.from(this.outputs))e.disconnect();return this}_key(t){return[t.name,t.inout].join("-")}_add(t){const e=this._key(t);if(t.node)throw new Error("Adding outlet to two nodes at once.");if(this.outlets[e])throw new Error(`Adding two identical outlets to same node. (${e})`);return t.node=this,t.inout===h.IN&&this.inputs.push(t),t.inout===h.OUT&&this.outputs.push(t),this.all.push(t),this.outlets[e]=t}_morph(t,e){let n=this._key(e);return delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e}_remove(t){const e=this._key(t);if(t.node!==this)throw new Error("Removing outlet from wrong node.");return t.disconnect(),t.node=null,delete this.outlets[e],t.inout===h.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===h.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this.all.splice(this.all.indexOf(t),1),this}}l.initClass();const{IN:c,OUT:p}=h;class d{static initClass(){this.index=0}static namespace(){return`_sn_${++d.index}_`}static load(t,e,n){const s=t.parse(e,n),[r,i]=Array.from(t.compile(s));return new d(t,r,i,e,n)}constructor(t,e,n,s,r){this.language=t,this._signatures=e,this._compiler=n,this._name=s,this._original=r,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.symbols=null,this.attributes=null,this.varyings=null,this.language||delete this.language,this._signatures||delete this._signatures,this._compiler||delete this._compiler,this._original||delete this._original,this._name||(this._name=null!=this._signatures?this._signatures.main.name:void 0)}clone(){return new d(this.language,this._signatures,this._compiler,this._name,this._original)}bind(t,e,n,s){let r,i,o;e===""+e?[n,e,s]=Array.from([e,null!=n?n:{},null!=s?s:{}]):n!==""+n&&([s,n]=Array.from([null!=n?n:{},void 0])),this.main=this._signatures.main,this.namespace=null!=(i=null!=n?n:this.namespace)?i:d.namespace(),this.entry=this.namespace+this.main.name,this.uniforms={},this.varyings={},this.attributes={},this.externals={},this.symbols=[];const a={},h={},u=function(t){return h[t]=!0,t},l=t=>this.namespace+t;if(t.globals)for(const e of Array.from(t.globals))u(e);const c=t.globalUniforms?u:l,p=t.globalVaryings?u:l,f=t.globalAttributes?u:l,m=l,y=t=>a[t.name]=!0,g=(t,e)=>this.uniforms[c(null!=e?e:t.name)]=t;o=t=>this.varyings[p(t.name)]=t;const x=t=>this.attributes[f(t.name)]=t,_=t=>{const e=m(t.name);return this.externals[e]=t,this.symbols.push(e)},w=t=>({type:t.type,name:t.name,value:t.value});for(r of Array.from(this._signatures.uniform))y(r);for(r of Array.from(this._signatures.uniform))g(w(r));for(r of Array.from(this._signatures.varying))o(w(r));for(r of Array.from(this._signatures.external))_(r);for(r of Array.from(this._signatures.attribute))x(w(r));for(const t in e)r=e[t],a[t]&&g(r,t);if(this.body=this.code=this._compiler(this.namespace,h,s),s){const t=(()=>{const t=[];for(const e in s)o=s[e],t.push(`#define ${e} ${o}`);return t})().join("\n");t.length&&(this._original=[t,"//----------------------------------------",this._original].join("\n"))}return null}}d.initClass();var f=n(760);const m=function(t,e,n,s){const r=t,i={},o=[],a={},h={},u={},l={},d=t=>{let e;(t=(()=>{const n=[];for(const s in t)e=t[s],n.push(e);return n})()).sort(((t,e)=>e.priority-t.priority));const n=(t,e,n)=>{y(t,e,n);const{main:i}=e,{entry:o}=e;return r.call((e=>_(t,e)),(e=>x(t,e)),o,i.signature,s)},s=r.body();for(e of Array.from(t))n(e.node,e.module,e.priority);return[s,t]},m=function(t,e,n){const s=l[t];return null!=s?s.priority=f.max(s.priority,n):l[t]={code:e,priority:n}},y=function(t,e,n){let s,r;n=f.make(n);for(const t in e.library){const s=e.library[t];m(t,s.code,f.nest(n,s.priority))}for(r in m(e.namespace,e.body,n),e.uniforms)s=e.uniforms[r],a[r]=s;for(r in e.varyings)s=e.varyings[r],h[r]=s;for(r in e.attributes)s=e.attributes[r],u[r]=s;return g(t,e)},g=(t,e)=>(()=>{const n=[];for(const s of Array.from(e.symbols)){const r=e.externals[s];if(x(t,r.name)){const e={};for(const t in r){const n=r[t];e[t]=n}e.name=_(t,r.name),i[s]=e,n.push(o.push(s))}else n.push(void 0)}return n})(),x=function(t,e){const n=t.get(e);return n.inout===c?null===n.input:n.inout===p?0===n.output.length:void 0},_=function(t,e){let n=t.get(e);return n?(n.input&&(n=n.input),({name:e}=n),n.id):null};return function(){let t,c;for(c in s){const t=s[c];g(t.node,t.module)}[t,n]=Array.from(d(n)),null!=e&&(t.entry=e);const p=r.build(t,n),m=(()=>{const t=[];for(c in l){const e=l[c];t.push(e)}return t})().sort(((t,e)=>f.compare(t.priority,e.priority))).map((t=>t.code));m.push(p.code);const y=r.lines(m);return{namespace:p.name,library:l,body:p.code,code:y,main:p,entry:p.name,symbols:o,externals:i,uniforms:a,varyings:h,attributes:u}}()};class y{static initClass(){this.index=0}static entry(){return`_pg_${++y.index}_`}constructor(t,e,n){this.language=t,this.namespace=e,this.graph=n,this.calls={},this.requires={}}call(t,e,n){let s;const r=e.namespace;return(s=this.calls[r])?s.priority=Math.max(s.priority,n):this.calls[r]={node:t,module:e,priority:n},this}require(t,e){const n=e.namespace;return this.requires[n]={node:t,module:e}}assemble(){const t=m(this.language,null!=this.namespace?this.namespace:y.entry,this.calls,this.requires),e=new d;for(const n in t)e[n]=t[n];return e.graph=this.graph,e}}y.initClass();const g=function(t,e,n,s){const r=t;let i=[];const o=[],a={},h={},u={},l={},d={},m=function(t,e,n){const s=d[t];return null!=s?s.priority=f.max(s.priority,n):d[t]={code:e,priority:n}},y=function(t,e,n){let s,r;n=f.make(n);for(const t in e.library){const s=e.library[t];m(t,s.code,f.nest(n,s.priority))}for(r in m(e.namespace,e.body,n),e.uniforms)s=e.uniforms[r],h[r]=s;for(r in e.varyings)s=e.varyings[r],l[r]=s;for(r in e.attributes)s=e.attributes[r],u[r]=s;return(()=>{const n=[];for(r of Array.from(e.symbols)){const s=e.externals[r];g(t,s.name)?(a[r]=s,n.push(o.push(r))):n.push(void 0)}return n})()},g=function(t,e){const n=t.get(e);if(!n){const n=null!=(null!=t.owner.snippet?t.owner.snippet._name:void 0)?null!=t.owner.snippet?t.owner.snippet._name:void 0:t.owner.namespace;throw new Error(`Unable to link program. Unlinked callback \`${e}\` on \`${n}\``)}return n.inout===c?null===n.input:n.inout===p?0===n.output.length:void 0};return function(){const t=r.links(e),o=[];null!=t.defs&&o.push(t.defs),null!=t.bodies&&o.push(t.bodies);for(const t of Array.from(n))y(t.node,t.module,t.priority);const c=(()=>{const t=[];for(const e in d){const n=d[e];t.push(n)}return t})().sort(((t,e)=>f.compare(t.priority,e.priority)));i=c.map((t=>t.code));let p=r.lines(i);p=r.defuse(p),o.length&&(p=[r.lines(o),p].join("\n")),p=r.hoist(p),p=r.dedupe(p);const m=s;return{namespace:m.main.name,code:p,main:m.main,entry:m.main.name,externals:a,uniforms:h,attributes:u,varyings:l}}()};class x{constructor(t,e){this.language=t,this.graph=e,this.links=[],this.includes=[],this.modules={},this.visits={}}callback(t,e,n,s,r){return this.links.push({node:t,module:e,priority:n,name:s,external:r})}include(t,e,n){let s;return null!=(s=this.modules[e.namespace])?s.priority=Math.max(n,s.priority):(this.modules[e.namespace]=!0,this.includes.push({node:t,module:e,priority:n}))}visit(t){return!this.visits[t]&&(this.visits[t]=!0)}link(t){const e=g(this.language,this.links,this.includes,t),n=new d;for(const t in e)n[t]=e[t];return n.graph=this.graph,n}}const{load:_}=d;class w{static previous(t){return null!=t.input?t.input.node.owner:void 0}constructor(t){null==t&&(t=!1),t||this.construct()}construct(){let t;return null==this.namespace&&(this.namespace=y.entry()),this.node=new l(this,null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}refresh(){let t;return this.node.setOutlets(null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}clone(){return new w}compile(t,e){const n=new y(t,null!=e?e:y.entry(),this.node.graph);return this.call(n,0),n.assemble()}link(t,e){const n=this.compile(t,e),s=new x(t,this.node.graph);return this._include(n,s,0),this.export(s,0),s.link(n)}call(t,e){}callback(t,e,n,s,r){}export(t,e){}_info(t){let e=null!=(null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0)?null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0:this.node.owner.namespace;if(null!=t)return e+"."+t}_outlet(t,e){const n=u.make(t,e);return n.meta.def=t,n}_call(t,e,n){return e.call(this.node,t,n)}_require(t,e){return e.require(this.node,t)}_inputs(t,e,n){return(()=>{const s=[];for(const r of Array.from(t.main.signature)){const t=this.node.get(r.name);s.push(b(w.previous(t),(t=>t.call(e,n+1))))}return s})()}_callback(t,e,n,s,r,i){return e.callback(this.node,t,n,s,r,i)}_include(t,e,n){return e.include(this.node,t,n)}_link(t,e,n){return(()=>{const s=[];for(const r of Array.from(t.symbols)){const i=t.externals[r];let o=this.node.get(i.name);if(!o)throw new M(`External not found on ${this._info(i.name)}`);if(null!=o.meta.child)continue;let a,h=o;for(;!a&&h;)[h,o]=Array.from([o.meta.parent,h]);if(a=w.previous(o),!a)throw new M(`Missing connection on ${this._info(i.name)}`);a.callback(e,n+1,r,i,o.input),s.push(null!=a?a.export(e,n+1):void 0)}return s})()}_trace(t,e,n){return(()=>{const s=[];for(const r of Array.from(t.main.signature)){const t=this.node.get(r.name);s.push(b(w.previous(t),(t=>t.export(e,n+1))))}return s})()}}const M=function(t){const e=new Error(t);return e.name="OutletError",e};function b(t,e){return null!=t?e(t):void 0}M.prototype=new Error;class v extends w{constructor(t){super(!0),this.snippet=t,this.namespace=t.namespace,this.construct()}clone(){return new v(this.snippet)}makeOutlets(){const t=this.snippet.main.signature,{externals:e}=this.snippet,{symbols:n}=this.snippet,s=Array.from(t).map((t=>this._outlet(t,{callback:!1}))),r=Array.from(n).map((t=>this._outlet(e[t],{callback:!0})));return s.concat(r)}call(t,e){return this._call(this.snippet,t,e),this._inputs(this.snippet,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.snippet,t,e),this._trace(this.snippet,t,e)}}class z extends w{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new z(this.graph)}makeOutlets(){let t;this.make();const e=[];let n=[],s=[];const r=(t,n)=>{if(!t.meta.callback)return n.push(t.type);if(t.inout===h.IN){const n=t.dupe();return null==n.meta.child&&(n.meta.child=t),t.meta.parent=n,e.push(n)}};for(t of Array.from(this.graph.inputs()))r(t,n);for(t of Array.from(this.graph.outputs()))r(t,s);n=n.join(","),s=s.join(",");const i=`(${n})(${s})`;return e.push({name:"callback",type:i,inout:h.OUT,meta:{callback:!0,def:this.subroutine.main}}),e}make(){return this.subroutine=this.graph.compile(this.namespace)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this.graph.export(t,e)}call(t,e){return this._require(this.subroutine,t,e)}callback(t,e,n,s,r){return this._include(this.subroutine,t,e),this._callback(this.subroutine,t,e,n,s,r)}}class k extends w{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new k(this.graph)}makeOutlets(){this.make();const t=[],e={},n={};for(const s of["inputs","outputs"])for(const r of Array.from(this.graph[s]())){let s;["return","callback"].includes(r.hint)&&r.inout===h.OUT&&(s=r.hint),null!=e[s]&&(s=void 0);const i=r.dupe(s);null==i.meta.child&&(i.meta.child=r),r.meta.parent=i,null!=s&&(e[s]=!0),n[r.name]=i,t.push(i)}return t}make(){return this.subroutine=this.graph.compile(this.namespace)}call(t,e){return this._call(this.subroutine,t,e),this._inputs(this.subroutine,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this._trace(this.subroutine,t,e),this.graph.export(t,e)}callback(t,e,n,s,r){return(r=r.meta.child).node.owner.callback(t,e,n,s,r)}}class A extends w{constructor(t){super(!0),this.nodes=t,this.construct()}clone(){return new A(this.nodes)}makeOutlets(){return[]}call(t,e){return(()=>{const n=[];for(const s of Array.from(this.nodes)){const r=s.owner;n.push(r.call(t,e))}return n})()}export(t,e){return(()=>{const n=[];for(const s of Array.from(this.nodes)){const r=s.owner;n.push(r.export(t,e))}return n})()}}const C=function(t){const e=[],n=[];for(const s of Array.from(t.nodes)){let t;const r={id:s.id,name:null,type:null,depth:null,graph:null,inputs:[],outputs:[]};e.push(r);const{inputs:i}=r,{outputs:o}=r,a=s.owner;a instanceof v?(r.name=a.snippet._name,r.type="call",r.code=a.snippet._original):a instanceof z?(r.name="Callback",r.type="callback",r.graph=C(a.graph)):a instanceof k?(r.name="Isolate",r.type="isolate",r.graph=C(a.graph)):a instanceof A?(r.name="Join",r.type="join"):null!=a&&(null==r.name&&(r.name=null!=a.name?a.name:a.type),null==r.type&&(r.type=a.type),null==r.code&&(r.code=a.code),null!=a.graph&&(r.graph=C(a.graph)));const h=function(t){return(t=t.replace(")(",")→(")).replace("()","")};for(t of Array.from(s.inputs))i.push({id:t.id,name:t.name,type:h(t.type),open:null==t.input});for(t of Array.from(s.outputs)){o.push({id:t.id,name:t.name,type:h(t.type),open:!t.output.length});for(const e of Array.from(t.output))n.push({from:s.id,out:t.id,to:e.node.id,in:e.id,type:h(t.type)})}}return{nodes:e,links:n}};let S=function(t,e){const n=65535&t,s=65535&e;return n*s+((t>>>16&65535)*s+n*(e>>>16&65535)<<16>>>0)|0};if(null!=Math.imul){-5===Math.imul(4294967295,5)&&({imul:S}=Math)}const E=function(t){let e;const n=t.length;let s=Math.floor(n/2),r=e=0;const i=()=>t.charCodeAt(r++),o=function(t,n){let s=t|n<<16;return s^=s<<9,s=S(s,3432918353),s=s<<15|s>>>17,s=S(s,461845907),e^=s,e=e<<13|e>>>19,e=S(e,5),e=e+3864292196|0};for(;s--;)o(i(),i());return 1&n&&o(i(),0),e^=n,e^=e>>>16,e=S(e,2246822507),e^=e>>>13,e=S(e,3266489909),e^=e>>>16},T=t=>(""+t).replace(/^\s+|\s+$/g,""),V=function(t,e){null==e&&(e=1);const n=1193046^E(t);let s=255&n,r=n>>>8&255,i=n>>>16&255;const o=Math.max(s,r,i),a=140/o,h=Math.round(o/3);return s=Math.min(255,Math.round(a*Math.max(s,h))),r=Math.min(255,Math.round(a*Math.max(r,h))),i=Math.min(255,Math.round(a*Math.max(i,h))),((t,e,n,s)=>"rgba("+[t,e,n,s].join(", ")+")")(s,r,i,e)},j=function(t){return(t=null!=t?t:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},F=function(t){const e=[],n=P(t,e);return n.update=()=>R(n,e),D(n),n},D=function(t){const e=t.querySelectorAll(".shadergraph-code");return Array.from(e).map((t=>function(){const e=t;return e.parentNode.classList.add("shadergraph-has-code"),e.parentNode.addEventListener("click",(t=>e.style.display={block:"none",none:"block"}[e.style.display||"none"]))}()))},P=function(t,e){let n;!function(t){let e,n;const s={},r={};for(n of Array.from(t.nodes))s[n.id]=n;for(e of Array.from(t.links))null==r[e.from]&&(r[e.from]=[]),r[e.from].push(e);const i=function(t,n){let o;if(null==n&&(n=0),t.depth=Math.max(null!=t.depth?t.depth:0,n),o=r[t.id])for(e of Array.from(o))i(s[e.to],n+1);return null};for(n of Array.from(t.nodes))null==n.depth&&i(n)}(t);const s=document.createElement("div");s.classList.add("shadergraph-graph");const r=[],i={};for(const s of Array.from(t.nodes)){let t;const o=document.createElement("div");o.classList.add("shadergraph-node"),o.classList.add(`shadergraph-node-${s.type}`),o.innerHTML=`<div class="shadergraph-header">${j(s.name)}</div>`;const a=function(t,e){const n=V(t.type),s=document.createElement("div");return s.classList.add("shadergraph-outlet"),s.classList.add(`shadergraph-outlet-${e}`),s.innerHTML=`<div class="shadergraph-point" style="background: ${n}"></div>\n<div class="shadergraph-type" style="color: ${n}">${j(t.type)}</div>\n<div class="shadergraph-name">${j(t.name)}</div>`,o.appendChild(s),i[t.id]=s.querySelector(".shadergraph-point")};for(t of Array.from(s.inputs))a(t,"in");for(t of Array.from(s.outputs))a(t,"out");if(null!=s.graph)o.appendChild(P(s.graph,e));else{const t=document.createElement("div");t.classList.add("shadergraph-clear"),o.appendChild(t)}if(null!=s.code){const t=document.createElement("div");t.classList.add("shadergraph-code"),t.innerHTML=j(T(s.code)),o.appendChild(t)}n=r[s.depth],null==n&&(n=document.createElement("div"),n.classList.add("shadergraph-column"),r[s.depth]=n),n.appendChild(o)}for(n of Array.from(r))null!=n&&s.appendChild(n);for(const n of Array.from(t.links)){const t=V(n.type);e.push({color:t,out:i[n.out],in:i[n.in]})}return s},O=t=>t*t,q=function(t,e,n,s){let r;const i=n-t,o=s-e,a=Math.sqrt(O(i)+O(o));if(Math.abs(o)>Math.abs(i)){const h=(t+n)/2,u=(e+s)/2,l=o>0?.3:-.3;return r=Math.min(Math.abs(i)/2,20+a/8),["M",t,e,"C",t+r,e+",",h,u-a*l,h,u,"C",h,u+a*l,n-r,s+",",n,s].join(" ")}return r=Math.min(Math.abs(i)/2.5,20+a/4),["M",t,e,"C",t+r,e+",",n-r,s+",",n,s].join(" ")},L=function(t){return null==t&&(t="svg"),document.createElementNS("http://www.w3.org/2000/svg",t)},R=function(t,e){let n;if(null==t.parentNode)return;const s=t.getBoundingClientRect();for(n of Array.from(e)){const t=n.out.getBoundingClientRect(),e=n.in.getBoundingClientRect();n.coords={x1:(t.left+t.right)/2-s.left,y1:(t.top+t.bottom)/2-s.top,x2:(e.left+e.right)/2-s.left,y2:(e.top+e.bottom)/2-s.top}}let r=t.querySelector("svg");null!=r&&t.removeChild(r);let i=t;for(;i.parentNode&&0===i.offsetHeight;)i=i.parentNode;for(n of(r=L(),r.setAttribute("width",i.offsetWidth),r.setAttribute("height",i.offsetHeight),Array.from(e))){const t=n.coords,e=L("path");e.setAttribute("d",q(t.x1,t.y1,t.x2,t.y2)),e.setAttribute("stroke",n.color),e.setAttribute("stroke-width",3),e.setAttribute("fill","transparent"),r.appendChild(e)}return t.appendChild(r)},I=function(t){const e=document.createElement("div");e.setAttribute("class","shadergraph-overlay");const n=document.createElement("div");n.setAttribute("class","shadergraph-close"),n.innerHTML="&times;";const s=document.createElement("div");s.setAttribute("class","shadergraph-view");const r=document.createElement("div");return r.setAttribute("class","shadergraph-inside"),r.appendChild(t),s.appendChild(r),e.appendChild(s),e.appendChild(n),n.addEventListener("click",(()=>e.parentNode.removeChild(e))),e},$=function(t){if(t instanceof Node)return t;const e=document.createElement("span");return e.innerText=null!=t?t:"",e},U=function(t){if(1!==t.length){let e;const n=document.createElement("div");for(e of Array.from(t))n.appendChild($(e));return n.update=()=>(()=>{const n=[];for(e of Array.from(t))n.push("function"==typeof e.update?e.update():void 0);return n})(),n}return $(t[0])},B=C,H=r,N=function(t){if(!t)return;if(!t.nodes)return t;const e=B(t);return H.process(e)},X=function(t){return null==t?t:t instanceof Array?t.map(X):null!=t.vertex&&null!=t.fragment?[X(t.vertex,X(t.fragment))]:null!=t._graph?t._graph:null!=t.graph?t.graph:t},Z=function(t){let e=[];for(const n of Array.from(t))n instanceof Array?e=e.concat(Z(n)):null!=n&&e.push(n);return e},G=function(){const t=Z(X([].slice.call(arguments)));return H.merge(Array.from(t).filter((t=>t)).map((t=>N(t))))},Q=function(){const t=G.apply(null,arguments),e=H.overlay(t);for(const t of Array.from(document.querySelectorAll(".shadergraph-overlay")))t.remove();return document.body.appendChild(e),t.update(),e};class Y{constructor(t,e,n){this.language=t,this.fetch=e,this.config=n,this.graph()}pipe(t,e,n,s){return t instanceof Y?this._concat(t):null!=t&&this._call(t,e,n,s),this}call(t,e,n,s){return this.pipe(t,e,n,s)}require(t,e,n,s){return t instanceof Y?this._import(t):null!=t&&(this.callback(),this._call(t,e,n,s),this.end()),this}import(t,e,n,s){return this.require(t,e,n,s)}split(){return this._group("_combine",!0),this}fan(){return this._group("_combine",!1),this}isolate(){return this._group("_isolate"),this}callback(){return this._group("_callback"),this}next(){return this._next(),this}pass(){const t=this._stack[2].end;return this.end(),this._state.end=this._state.end.concat(t),this}end(){const[t,e]=Array.from(this._exit()),{op:n}=t;return this[n]&&this[n](t,e),this}join(){return this.end()}graph(){for(;(null!=this._stack?this._stack.length:void 0)>1;)this.end();this._graph&&this._tail(this._state,this._graph);const t=this._graph;return this._graph=new h,this._state=new W,this._stack=[this._state],t}compile(t){return null==t&&(t="main"),this.graph().compile(t)}link(t){return null==t&&(t="main"),this.graph().link(t)}serialize(){return B(this._graph)}empty(){return 0===this._graph.nodes.length}_concat(t){let e;if(0===t._state.nodes.length)return this;this._tail(t._state,t._graph);try{e=new k(t._graph)}catch(e){throw this.config.autoInspect&&Q(e,this._graph,t),e}return this._auto(e),this}_import(t){let e;if(0===t._state.nodes.length)throw"Can't import empty callback";this._tail(t._state,t._graph);try{e=new z(t._graph)}catch(e){throw this.config.autoInspect&&Q(e,this._graph,t),e}return this._auto(e),this}_combine(t,e){for(const n of Array.from(t.start))for(const s of Array.from(e.end))s.connect(n,t.multi);return e.end=t.end,e.nodes=e.nodes.concat(t.nodes)}_isolate(t,e){if(t.nodes.length){let e;const n=this._subgraph(t);this._tail(t,n);try{e=new k(n)}catch(t){throw this.config.autoInspect&&Q(t,this._graph,n),t}return this._auto(e)}}_callback(t,e){if(t.nodes.length){let e;const n=this._subgraph(t);this._tail(t,n);try{e=new z(n)}catch(t){throw this.config.autoInspect&&Q(t,this._graph,n),t}return this._auto(e)}}_call(t,e,n,s){const r=this.fetch(t);r.bind(this.config,e,n,s);const i=new v(r);return this._auto(i)}_subgraph(t){const e=new h(null,this._graph);return e.adopt(t.nodes),e}_tail(t,e){let n=t.end.concat(t.tail);if(n=n.filter(((t,e)=>n.indexOf(t)===e)),n.length>1&&(n=new A(n),n=[n.node],this._graph.add(n)),e.tail=n[0],t.end=n,t.tail=[],!e.tail)throw new Error("Cannot finalize empty graph");return e.compile=t=>{null==t&&(t="main");try{return e.tail.owner.compile(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.link=t=>{null==t&&(t="main");try{return e.tail.owner.link(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.export=(t,n)=>e.tail.owner.export(t,n),e.inspect=(t=null)=>Q(t,e)}_group(t,e){return this._push(t,e),this._push(),this}_next(){const t=this._pop();return this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._state.tail=this._state.tail.concat(t.tail),this._push()}_exit(){return this._next(),this._pop(),[this._pop(),this._state]}_push(t,e){return this._stack.unshift(new W(t,e)),this._state=this._stack[0]}_pop(){let t;return this._state=this._stack[1],null==this._state&&(this._state=new W),null!=(t=this._stack.shift())?t:new W}_auto(t){return t.node.inputs.length?this._append(t):this._insert(t)}_append(t){let e;const{node:n}=t;for(e of(this._graph.add(n),Array.from(this._state.end)))e.connect(n);this._state.start.length||(this._state.start=[n]),this._state.end=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_prepend(t){let e;const{node:n}=t;for(e of(this._graph.add(n),Array.from(this._state.start)))n.connect(e);this._state.end.length||(this._state.end=[n]),this._state.start=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_insert(t){const{node:e}=t;if(this._graph.add(e),this._state.start.push(e),this._state.end.push(e),this._state.nodes.push(e),!e.outputs.length)return this._state.tail.push(e)}}class W{constructor(t=null,e,n,s,r,i){this.op=t,null==e&&(e=!1),this.multi=e,null==n&&(n=[]),this.start=n,null==s&&(s=[]),this.end=s,null==r&&(r=[]),this.nodes=r,null==i&&(i=[]),this.tail=i}}class J{constructor(t,e){this.vertex=t,this.fragment=e}build(t){return this.link(t)}link(t){null==t&&(t={});const e={},n={},s={},r=this.vertex.link("main"),i=this.fragment.link("main");for(const t of[r,i]){for(const n in t.uniforms){const s=t.uniforms[n];e[n]=s}for(const e in t.varyings){const s=t.varyings[e];n[e]=s}for(const e in t.attributes){const n=t.attributes[e];s[e]=n}}return t.vertexShader=r.code,t.vertexGraph=r.graph,t.fragmentShader=i.code,t.fragmentGraph=i.graph,t.attributes=s,t.uniforms=e,t.varyings=n,t.inspect=()=>Q("Vertex Shader",r,"Fragment Shader",i.graph),t}inspect(){return Q("Vertex Shader",this.vertex,"Fragment Shader",this.fragment.graph)}}const K=function(t,e,n){let s=null,r={};null!=e&&("function"==typeof e?s=s=>n(t,s,e(s)):"object"==typeof e&&(s=function(s){if(null==e[s])throw new Error(`Unknown snippet \`${s}\``);return n(t,s,e[s])}));const i=e=>n(t,"",e);if(null==s)return i;const o=function(t){return t.match(/[{;]/)?i(t):(r[t]=!0,s(t))};return o.used=function(t){return null==t&&(t=r),r=t},o},tt=function(t){null==t&&(t=100);const e={};let n=null,s=null,r=0;const i=function(t){if(t.prev=null,t.next=n,null!=n&&(n.prev=t),n=t,null==s)return s=t},o=function(t){const{prev:e}=t,{next:r}=t;if(null!=e&&(e.next=r),null!=r&&(r.prev=e),n===t&&(n=r),s===t)return s=e};return function(a){let h,u;return(u=e[a])&&u!==n?(o(u),i(u)):(r===t?(h=s.key,o(s),delete e[h]):r++,u={next:n,prev:null,key:a},i(u),e[a]=u),h}},et=function(t){const e={},n=tt(100);return function(s){const r=s.length>32?"##"+E(s).toString(16):s,i=n(r);return null!=i&&delete e[i],null==e[r]&&(e[r]=t(s)),e[r].clone()}},nt=function(t){const{code:e,signatures:n}=t,s=st(n);return[n,rt(e,s)]},st=function(t){const e={},n=t=>e[t.name]=!0;n(t.main);for(const e of["external","internal","varying","uniform","attribute"])for(const s of t[e])n(s);return e},rt=function(t,e){let n;const s=new RegExp("\\b("+(()=>{const t=[];for(n in e)t.push(n);return t})().join("|")+")\\b","g");return t=(t=t.replace(/\/\/[^\n]*/g,"")).replace(/\/\*([^*]|\*[^/])*\*\//g,""),function(n,r,i){let o;null==n&&(n=""),null==r&&(r={}),null==i&&(i={});const a={};for(o in e)a[o]=null!=r[o]?o:n+o;const h=t.replace(s,(t=>a[t])),u=(()=>{const t=[];for(o in i){const e=i[o];t.push(`#define ${o} ${e}`)}return t})();return u.length&&u.push(""),u.join("\n")+h}};var it=n(932),ot=n.n(it),at=n(960),ht=n.n(at);class ut{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),s=Math.sin(e),r=this.x-t.x,i=this.y-t.y;return this.x=r*n-i*s+t.x,this.y=r*s+i*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}ut.prototype.isVector2=!0;const lt=[];for(let t=0;t<256;t++)lt[t]=(t<16?"0":"")+t.toString(16);Math.PI,Math.PI;function ct(t,e,n){return Math.max(e,Math.min(n,t))}class pt{constructor(t=0,e=0,n=0,s=1){this._x=t,this._y=e,this._z=n,this._w=s}static slerp(t,e,n,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,s)}static slerpFlat(t,e,n,s,r,i,o){let a=n[s+0],h=n[s+1],u=n[s+2],l=n[s+3];const c=r[i+0],p=r[i+1],d=r[i+2],f=r[i+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=u,void(t[e+3]=l);if(1===o)return t[e+0]=c,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(l!==f||a!==c||h!==p||u!==d){let t=1-o;const e=a*c+h*p+u*d+l*f,n=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),i=Math.atan2(r,e*n);t=Math.sin(t*i)/r,o=Math.sin(o*i)/r}const r=o*n;if(a=a*t+c*r,h=h*t+p*r,u=u*t+d*r,l=l*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+h*h+u*u+l*l);a*=t,h*=t,u*=t,l*=t}}t[e]=a,t[e+1]=h,t[e+2]=u,t[e+3]=l}static multiplyQuaternionsFlat(t,e,n,s,r,i){const o=n[s],a=n[s+1],h=n[s+2],u=n[s+3],l=r[i],c=r[i+1],p=r[i+2],d=r[i+3];return t[e]=o*d+u*l+a*p-h*c,t[e+1]=a*d+u*c+h*l-o*p,t[e+2]=h*d+u*p+o*c-a*l,t[e+3]=u*d-o*l-a*c-h*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,s=t._y,r=t._z,i=t._order,o=Math.cos,a=Math.sin,h=o(n/2),u=o(s/2),l=o(r/2),c=a(n/2),p=a(s/2),d=a(r/2);switch(i){case"XYZ":this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d;break;case"YXZ":this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d;break;case"ZXY":this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d;break;case"ZYX":this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d;break;case"YZX":this._x=c*u*l+h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l-c*p*d;break;case"XZY":this._x=c*u*l-h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l+c*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],r=e[8],i=e[1],o=e[5],a=e[9],h=e[2],u=e[6],l=e[10],c=n+o+l;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(u-a)*t,this._y=(r-h)*t,this._z=(i-s)*t}else if(n>o&&n>l){const t=2*Math.sqrt(1+n-o-l);this._w=(u-a)/t,this._x=.25*t,this._y=(s+i)/t,this._z=(r+h)/t}else if(o>l){const t=2*Math.sqrt(1+o-n-l);this._w=(r-h)/t,this._x=(s+i)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+l-n-o);this._w=(i-s)/t,this._x=(r+h)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ct(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,r=t._z,i=t._w,o=e._x,a=e._y,h=e._z,u=e._w;return this._x=n*u+i*o+s*h-r*a,this._y=s*u+i*a+r*o-n*h,this._z=r*u+i*h+n*a-s*o,this._w=i*u-n*o-s*a-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,s=this._y,r=this._z,i=this._w;let o=i*t._w+n*t._x+s*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=i,this._x=n,this._y=s,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*i+e*this._w,this._x=t*n+e*this._x,this._y=t*s+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(a),u=Math.atan2(h,o),l=Math.sin((1-e)*u)/h,c=Math.sin(e*u)/h;return this._w=i*l+this._w*c,this._x=n*l+this._x*c,this._y=s*l+this._y*c,this._z=r*l+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}pt.prototype.isQuaternion=!0;class dt{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(mt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(mt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*s,this.y=r[1]*e+r[4]*n+r[7]*s,this.z=r[2]*e+r[5]*n+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,r=t.elements,i=1/(r[3]*e+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*s+r[12])*i,this.y=(r[1]*e+r[5]*n+r[9]*s+r[13])*i,this.z=(r[2]*e+r[6]*n+r[10]*s+r[14])*i,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,r=t.x,i=t.y,o=t.z,a=t.w,h=a*e+i*s-o*n,u=a*n+o*e-r*s,l=a*s+r*n-i*e,c=-r*e-i*n-o*s;return this.x=h*a+c*-r+u*-o-l*-i,this.y=u*a+c*-i+l*-r-h*-o,this.z=l*a+c*-o+h*-i-u*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*s,this.y=r[1]*e+r[5]*n+r[9]*s,this.z=r[2]*e+r[6]*n+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,r=t.z,i=e.x,o=e.y,a=e.z;return this.x=s*a-r*o,this.y=r*i-n*a,this.z=n*o-s*i,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return ft.copy(this).projectOnVector(t),this.sub(ft)}reflect(t){return this.sub(ft.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ct(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}dt.prototype.isVector3=!0;const ft=new dt,mt=new pt;class yt{constructor(t=0,e=0,n=0,s=1){this.x=t,this.y=e,this.z=n,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,r=this.w,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s+i[12]*r,this.y=i[1]*e+i[5]*n+i[9]*s+i[13]*r,this.z=i[2]*e+i[6]*n+i[10]*s+i[14]*r,this.w=i[3]*e+i[7]*n+i[11]*s+i[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,s,r;const i=.01,o=.1,a=t.elements,h=a[0],u=a[4],l=a[8],c=a[1],p=a[5],d=a[9],f=a[2],m=a[6],y=a[10];if(Math.abs(u-c)<i&&Math.abs(l-f)<i&&Math.abs(d-m)<i){if(Math.abs(u+c)<o&&Math.abs(l+f)<o&&Math.abs(d+m)<o&&Math.abs(h+p+y-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(p+1)/2,g=(y+1)/2,x=(u+c)/4,_=(l+f)/4,w=(d+m)/4;return t>a&&t>g?t<i?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(t),s=x/n,r=_/n):a>g?a<i?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(a),n=x/s,r=w/s):g<i?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(g),n=_/r,s=w/r),this.set(n,s,r,e),this}let g=Math.sqrt((m-d)*(m-d)+(l-f)*(l-f)+(c-u)*(c-u));return Math.abs(g)<.001&&(g=1),this.x=(m-d)/g,this.y=(l-f)/g,this.z=(c-u)/g,this.w=Math.acos((h+p+y-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}yt.prototype.isVector4=!0;class gt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,s,r,i,o,a,h){const u=this.elements;return u[0]=t,u[1]=s,u[2]=o,u[3]=e,u[4]=r,u[5]=a,u[6]=n,u[7]=i,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,r=this.elements,i=n[0],o=n[3],a=n[6],h=n[1],u=n[4],l=n[7],c=n[2],p=n[5],d=n[8],f=s[0],m=s[3],y=s[6],g=s[1],x=s[4],_=s[7],w=s[2],M=s[5],b=s[8];return r[0]=i*f+o*g+a*w,r[3]=i*m+o*x+a*M,r[6]=i*y+o*_+a*b,r[1]=h*f+u*g+l*w,r[4]=h*m+u*x+l*M,r[7]=h*y+u*_+l*b,r[2]=c*f+p*g+d*w,r[5]=c*m+p*x+d*M,r[8]=c*y+p*_+d*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return e*i*u-e*o*h-n*r*u+n*o*a+s*r*h-s*i*a}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=u*i-o*h,c=o*a-u*r,p=h*r-i*a,d=e*l+n*c+s*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=l*f,t[1]=(s*h-u*n)*f,t[2]=(o*n-s*i)*f,t[3]=c*f,t[4]=(u*e-s*a)*f,t[5]=(s*r-o*e)*f,t[6]=p*f,t[7]=(n*a-h*e)*f,t[8]=(i*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,s,r,i,o){const a=Math.cos(r),h=Math.sin(r);return this.set(n*a,n*h,-n*(a*i+h*o)+i+t,-s*h,s*a,-s*(-h*i+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),s=this.elements,r=s[0],i=s[3],o=s[6],a=s[1],h=s[4],u=s[7];return s[0]=e*r+n*a,s[3]=e*i+n*h,s[6]=e*o+n*u,s[1]=-n*r+e*a,s[4]=-n*i+e*h,s[7]=-n*o+e*u,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}gt.prototype.isMatrix3=!0;class xt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,s,r,i,o,a,h,u,l,c,p,d,f,m){const y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=s,y[1]=r,y[5]=i,y[9]=o,y[13]=a,y[2]=h,y[6]=u,y[10]=l,y[14]=c,y[3]=p,y[7]=d,y[11]=f,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new xt).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,s=1/_t.setFromMatrixColumn(t,0).length(),r=1/_t.setFromMatrixColumn(t,1).length(),i=1/_t.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*i,e[9]=n[9]*i,e[10]=n[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,s=t.y,r=t.z,i=Math.cos(n),o=Math.sin(n),a=Math.cos(s),h=Math.sin(s),u=Math.cos(r),l=Math.sin(r);if("XYZ"===t.order){const t=i*u,n=i*l,s=o*u,r=o*l;e[0]=a*u,e[4]=-a*l,e[8]=h,e[1]=n+s*h,e[5]=t-r*h,e[9]=-o*a,e[2]=r-t*h,e[6]=s+n*h,e[10]=i*a}else if("YXZ"===t.order){const t=a*u,n=a*l,s=h*u,r=h*l;e[0]=t+r*o,e[4]=s*o-n,e[8]=i*h,e[1]=i*l,e[5]=i*u,e[9]=-o,e[2]=n*o-s,e[6]=r+t*o,e[10]=i*a}else if("ZXY"===t.order){const t=a*u,n=a*l,s=h*u,r=h*l;e[0]=t-r*o,e[4]=-i*l,e[8]=s+n*o,e[1]=n+s*o,e[5]=i*u,e[9]=r-t*o,e[2]=-i*h,e[6]=o,e[10]=i*a}else if("ZYX"===t.order){const t=i*u,n=i*l,s=o*u,r=o*l;e[0]=a*u,e[4]=s*h-n,e[8]=t*h+r,e[1]=a*l,e[5]=r*h+t,e[9]=n*h-s,e[2]=-h,e[6]=o*a,e[10]=i*a}else if("YZX"===t.order){const t=i*a,n=i*h,s=o*a,r=o*h;e[0]=a*u,e[4]=r-t*l,e[8]=s*l+n,e[1]=l,e[5]=i*u,e[9]=-o*u,e[2]=-h*u,e[6]=n*l+s,e[10]=t-r*l}else if("XZY"===t.order){const t=i*a,n=i*h,s=o*a,r=o*h;e[0]=a*u,e[4]=-l,e[8]=h*u,e[1]=t*l+r,e[5]=i*u,e[9]=n*l-s,e[2]=s*l-n,e[6]=o*u,e[10]=r*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Mt,t,bt)}lookAt(t,e,n){const s=this.elements;return kt.subVectors(t,e),0===kt.lengthSq()&&(kt.z=1),kt.normalize(),vt.crossVectors(n,kt),0===vt.lengthSq()&&(1===Math.abs(n.z)?kt.x+=1e-4:kt.z+=1e-4,kt.normalize(),vt.crossVectors(n,kt)),vt.normalize(),zt.crossVectors(kt,vt),s[0]=vt.x,s[4]=zt.x,s[8]=kt.x,s[1]=vt.y,s[5]=zt.y,s[9]=kt.y,s[2]=vt.z,s[6]=zt.z,s[10]=kt.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,r=this.elements,i=n[0],o=n[4],a=n[8],h=n[12],u=n[1],l=n[5],c=n[9],p=n[13],d=n[2],f=n[6],m=n[10],y=n[14],g=n[3],x=n[7],_=n[11],w=n[15],M=s[0],b=s[4],v=s[8],z=s[12],k=s[1],A=s[5],C=s[9],S=s[13],E=s[2],T=s[6],V=s[10],j=s[14],F=s[3],D=s[7],P=s[11],O=s[15];return r[0]=i*M+o*k+a*E+h*F,r[4]=i*b+o*A+a*T+h*D,r[8]=i*v+o*C+a*V+h*P,r[12]=i*z+o*S+a*j+h*O,r[1]=u*M+l*k+c*E+p*F,r[5]=u*b+l*A+c*T+p*D,r[9]=u*v+l*C+c*V+p*P,r[13]=u*z+l*S+c*j+p*O,r[2]=d*M+f*k+m*E+y*F,r[6]=d*b+f*A+m*T+y*D,r[10]=d*v+f*C+m*V+y*P,r[14]=d*z+f*S+m*j+y*O,r[3]=g*M+x*k+_*E+w*F,r[7]=g*b+x*A+_*T+w*D,r[11]=g*v+x*C+_*V+w*P,r[15]=g*z+x*S+_*j+w*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],s=t[8],r=t[12],i=t[1],o=t[5],a=t[9],h=t[13],u=t[2],l=t[6],c=t[10],p=t[14];return t[3]*(+r*a*l-s*h*l-r*o*c+n*h*c+s*o*p-n*a*p)+t[7]*(+e*a*p-e*h*c+r*i*c-s*i*p+s*h*u-r*a*u)+t[11]*(+e*h*l-e*o*p-r*i*l+n*i*p+r*o*u-n*h*u)+t[15]*(-s*o*u-e*a*l+e*o*c+s*i*l-n*i*c+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],p=t[11],d=t[12],f=t[13],m=t[14],y=t[15],g=l*m*h-f*c*h+f*a*p-o*m*p-l*a*y+o*c*y,x=d*c*h-u*m*h-d*a*p+i*m*p+u*a*y-i*c*y,_=u*f*h-d*l*h+d*o*p-i*f*p-u*o*y+i*l*y,w=d*l*a-u*f*a-d*o*c+i*f*c+u*o*m-i*l*m,M=e*g+n*x+s*_+r*w;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/M;return t[0]=g*b,t[1]=(f*c*r-l*m*r-f*s*p+n*m*p+l*s*y-n*c*y)*b,t[2]=(o*m*r-f*a*r+f*s*h-n*m*h-o*s*y+n*a*y)*b,t[3]=(l*a*r-o*c*r-l*s*h+n*c*h+o*s*p-n*a*p)*b,t[4]=x*b,t[5]=(u*m*r-d*c*r+d*s*p-e*m*p-u*s*y+e*c*y)*b,t[6]=(d*a*r-i*m*r-d*s*h+e*m*h+i*s*y-e*a*y)*b,t[7]=(i*c*r-u*a*r+u*s*h-e*c*h-i*s*p+e*a*p)*b,t[8]=_*b,t[9]=(d*l*r-u*f*r-d*n*p+e*f*p+u*n*y-e*l*y)*b,t[10]=(i*f*r-d*o*r+d*n*h-e*f*h-i*n*y+e*o*y)*b,t[11]=(u*o*r-i*l*r-u*n*h+e*l*h+i*n*p-e*o*p)*b,t[12]=w*b,t[13]=(u*f*s-d*l*s+d*n*c-e*f*c-u*n*m+e*l*m)*b,t[14]=(d*o*s-i*f*s-d*n*a+e*f*a+i*n*m-e*o*m)*b,t[15]=(i*l*s-u*o*s+u*n*a-e*l*a-i*n*c+e*o*c)*b,this}scale(t){const e=this.elements,n=t.x,s=t.y,r=t.z;return e[0]*=n,e[4]*=s,e[8]*=r,e[1]*=n,e[5]*=s,e[9]*=r,e[2]*=n,e[6]*=s,e[10]*=r,e[3]*=n,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),s=Math.sin(e),r=1-n,i=t.x,o=t.y,a=t.z,h=r*i,u=r*o;return this.set(h*i+n,h*o-s*a,h*a+s*o,0,h*o+s*a,u*o+n,u*a-s*i,0,h*a-s*o,u*a+s*i,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,s,r,i){return this.set(1,n,r,0,t,1,i,0,e,s,1,0,0,0,0,1),this}compose(t,e,n){const s=this.elements,r=e._x,i=e._y,o=e._z,a=e._w,h=r+r,u=i+i,l=o+o,c=r*h,p=r*u,d=r*l,f=i*u,m=i*l,y=o*l,g=a*h,x=a*u,_=a*l,w=n.x,M=n.y,b=n.z;return s[0]=(1-(f+y))*w,s[1]=(p+_)*w,s[2]=(d-x)*w,s[3]=0,s[4]=(p-_)*M,s[5]=(1-(c+y))*M,s[6]=(m+g)*M,s[7]=0,s[8]=(d+x)*b,s[9]=(m-g)*b,s[10]=(1-(c+f))*b,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,n){const s=this.elements;let r=_t.set(s[0],s[1],s[2]).length();const i=_t.set(s[4],s[5],s[6]).length(),o=_t.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],wt.copy(this);const a=1/r,h=1/i,u=1/o;return wt.elements[0]*=a,wt.elements[1]*=a,wt.elements[2]*=a,wt.elements[4]*=h,wt.elements[5]*=h,wt.elements[6]*=h,wt.elements[8]*=u,wt.elements[9]*=u,wt.elements[10]*=u,e.setFromRotationMatrix(wt),n.x=r,n.y=i,n.z=o,this}makePerspective(t,e,n,s,r,i){void 0===i&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),h=2*r/(n-s),u=(e+t)/(e-t),l=(n+s)/(n-s),c=-(i+r)/(i-r),p=-2*i*r/(i-r);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,s,r,i){const o=this.elements,a=1/(e-t),h=1/(n-s),u=1/(i-r),l=(e+t)*a,c=(n+s)*h,p=(i+r)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}xt.prototype.isMatrix4=!0;const _t=new dt,wt=new xt,Mt=new dt(0,0,0),bt=new dt(1,1,1),vt=new dt,zt=new dt,kt=new dt,At={in:0,out:1,inout:2},Ct=t=>t.token.data;At.node=function(t){return"function"===(null!=t.children[5]?t.children[5].type:void 0)?At.function(t):"keyword"===(null!=t.token?t.token.type:void 0)?At.external(t):void 0},At.external=function(t){let e=t.children,n=Ct(e[1]);const s=Ct(e[4]),r=e[5];["attribute","uniform","varying"].includes(n)||(n="global");const i=[];for(let t=0;t<r.children.length;t++)if(e=r.children[t],"ident"===e.type){const o=Ct(e),a=r.children[t+1],h="quantifier"===(null!=a?a.type:void 0);i.push({decl:"external",storage:n,type:s,ident:o,quant:!!h,count:h})}return i},At.function=function(t){const e=t.children,n=Ct(e[1]),s=Ct(e[4]),r=e[5],i=Ct(r.children[0]),o=r.children[1];return[{decl:"function",storage:n,type:s,ident:i,body:!!r.children[2],args:Array.from(o.children).map((t=>At.argument(t)))}]},At.argument=function(t){const e=t.children,n=Ct(e[1]),s=Ct(e[2]),r=Ct(e[4]),i=e[5],o=Ct(i.children[0]),a=i.children[1];return{decl:"argument",storage:n,inout:s,type:r,ident:o,quant:!!a,count:a?a.children[0].token.data:void 0}},At.param=function(t,e,n,s,r){let i=[];null!=e&&i.push(e),null!=n&&i.push(n),i.push(""),i=i.join(" ");const o=s?"["+r+"]":"";""!==t&&(t+=" ");const a=(e,n)=>(n?t:"")+`${i}${e}${o}`;return a.split=t=>At.param(t,e,n,s,r),a};const St="undefined"!=typeof window&&!!window.THREE,Et={int:0,float:0,vec2:St?ut:null,vec3:St?dt:null,vec4:St?yt:null,mat2:null,mat3:St?gt:null,mat4:St?xt:null,sampler2D:0,samplerCube:0},Tt={int:"i",float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat2:"m2",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};At.type=function(t,e,n,s,r,i){const o={in:At.in,out:At.out,inout:At.inout};let a=Tt[e];n&&(a+="v");let h=Et[e];(null!=h?h.call:void 0)&&(h=new h),n&&(h=[h]);const u=null!=o[r]?o[r]:o.in;i={const:"const"}[i];const l=At.param(r,i,e,n,s);return new Vt(t,a,e,l,h,u)};class Vt{constructor(t,e,n,s,r,i,o){this.name=t,this.type=e,this.spec=n,this.param=s,this.value=r,this.inout=i,this.meta=o}split(){const t=null!=this.meta.shadowed,e=t?"in":"out",n=t?At.in:At.out,s=this.param.split(e);return new Vt(this.name,this.type,this.spec,s,this.value,n)}copy(t,e){return new Vt(null!=t?t:this.name,this.type,this.spec,this.param,this.value,this.inout,e)}}const jt="_i_o",Ft="return";let Dt=!1;const Pt=function(t,e){const n=Ot(t,e);return qt(n,e)},Ot=function(t,e){let n,s,r=[];Dt&&(s=Bt());try{const t=ot()(e);n=ht()(t)}catch(t){r=[{message:t}]}Dt&&s("GLSL Tokenize & Parse");const i=function(t){const e=(""+(t=t.split("\n")).length).length;return t.map(((t,n)=>{return`${s=n+1,(s=""+s).length<e?("       "+s).slice(-e):s}: ${t}`;var s})).join("\n")};if(!n||r.length){t||(t="(inline code)"),console.warn(i(e));for(const e of r)console.error(`${t} -`,e.message);throw new Error("GLSL parse error")}return n},qt=function(t,e){let n;Dt&&(n=Bt());const s=[];Ut(Lt,Rt(s),t,"");const[r,i,o]=Array.from(It(s)),a=$t(r,i,o);return Dt&&n("GLSL AST"),{ast:t,code:e,signatures:a}},Lt=function(t,e){switch(t.type){case"decl":return e(At.node(t)),!1}return!0},Rt=t=>function(e){null!=e&&Array.from(e).map((e=>t.push(e)))},It=function(t){let e=null;const n=[];let s=[];const r={};let i=!1;for(const o of Array.from(t))o.body?(r[o.ident]&&(s=Array.from(s).filter((t=>t.ident!==o.ident)),delete r[o.ident]),n.push(o),"main"===o.ident?(e=o,i=!0):i||(e=o)):"global"===o.storage?n.push(o):(s.push(o),r[o.ident]=!0);return[e,n,s]},$t=function(t,e,n){let s;const r={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},i=t=>At.type(t.ident,t.type,t.quant,t.count,t.inout,t.storage),o=function(t,e){let n;const s=Array.from(t.args).map((t=>i(t)));for(n of Array.from(s))if(n.inout===At.inout){const t=n,e=n.copy();t.inout=At.in,e.inout=At.out,e.meta={shadow:t.name},e.name+=jt,t.meta={shadowed:e.name},s.push(e)}"void"!==t.type&&s.unshift(At.type(Ft,t.type,!1,"","out"));const r=`(${(()=>{const t=[];for(n of Array.from(s))n.inout===At.in&&t.push(n.type);return t})().join(",")})(${(()=>{const t=[];for(n of Array.from(s))n.inout===At.out&&t.push(n.type);return t})().join(",")})`;return{name:t.ident,type:r,signature:s,inout:e,spec:t.type}};for(s of(r.main=o(t,At.out),Array.from(e)))r.internal.push({name:s.ident});for(s of Array.from(n)){let t;switch(s.decl){case"external":t=i(s),r[s.storage].push(t);break;case"function":t=o(s,At.in),r.external.push(t)}}return r};Dt=!1;const Ut=function(t,e,n,s){Dt&&console.log(s,n.type,null!=n.token?n.token.data:void 0,null!=n.token?n.token.type:void 0);if(t(n,e))for(let r=0;r<n.children.length;r++){const i=n.children[r];Ut(t,e,i,s+"  ",Dt)}return null},Bt=function(){const t=+new Date;return function(e){const n=+new Date-t;return console.log(e,n+" ms"),n}};function Ht(t){const e=t.replace(jt,"");return e!==t?e:null}function Nt(t){return t.join("\n")}function Xt(t){return t.join(", ")}function Zt(t){return t.join(";\n")}function Gt(t){return{entry:t,type:"void",params:[],signature:[],return:"",vars:{},calls:[],post:[],chain:{}}}function Qt(t,e){return`#define ${t} ${e}`}function Yt(t,e,n,s,r){return`${t} ${e}(${n}) {\n${s}${r}}`}function Wt(t,e,n){return`  ${t=t?`${t} = `:""}${e}(${n=Xt(n)})`}function Jt(t,e){for(let n=0;n<t.length;n++){const s=t[n],r=e[n];if(!r)return!1;if(s.type!==r.type)return!1;if(s.name===Ft!=(r.name===Ft))return!1}return!0}function Kt(t,e,n,s,r){const i=[];let o="";for(let n of Array.from(s)){let s,a;const{name:h}=n;let u=s=t(h),l=null,c=null,p=!1;const d=h===Ft;if((a=null!=n.meta?n.meta.shadowed:void 0)&&(l=t(a),l&&(r.vars[l]="  "+n.param(l),r.calls.push(`  ${l} = ${s}`),e(a)?c={shadowed:l}:n=n.split())),(a=null!=n.meta?n.meta.shadow:void 0)&&(l=t(a),l)){if(e(a)){c={shadow:l};continue}n=n.split(),p=!0}if(d?o=s:p||i.push(null!=l?l:s),e(h)){let t="push";d?""===r.return?(t="unshift",u=h,r.type=n.spec,r.return=`  return ${s}`,r.vars[s]="  "+n.param(s)):(r.vars[s]="  "+n.param(s),r.params.push(n.param(s,!0))):r.params.push(n.param(s,!0)),n=n.copy(u,c),r.signature[t](n)}else r.vars[s]="  "+n.param(s)}return r.calls.push(Wt(o,n,i))}function te(t,e){const{entry:n}=t;let s=null;if(e&&1===e.length&&"main"!==n){const r=e[0].module;Jt(t.signature,r.main.signature)&&(s=Qt(n,r.entry))}if(null==s){let r=(()=>{const e=[];for(const n in t.vars){const s=t.vars[n];e.push(s)}return e})();({calls:e}=t);const{post:i}=t;let{params:o}=t;const{type:a}=t,h=t.return;e=e.concat(i),""!==h&&e.push(h),e.push(""),r.length?(r.push(""),r=Zt(r)+"\n"):r="",e=Zt(e),o=Xt(o),s=Yt(a,n,o,r,e)}return{signature:t.signature,code:s,name:n}}function ee(t){const e={defs:[],bodies:[]};for(const n of Array.from(t))ne(n,e);return e.defs=Nt(e.defs),e.bodies=Zt(e.bodies),""===e.defs&&delete e.defs,""===e.bodies&&delete e.bodies,e}const ne=(t,e)=>{let n,s;const{module:r,name:i,external:o}=t,{main:a}=r,{entry:h}=r;if(Jt(a.signature,o.signature))return e.defs.push(Qt(i,h));const u=[],l=[];let p={};const d=[r.namespace,Ft].join("");for(n of Array.from(o.signature))s=n.inout===c?u:l,s.push(n);for(n of Array.from(a.signature)){s=n.inout===c?u:l;let t=s.shift().name;t===Ft&&(t=d),p[n.name]=t}let f=t=>p[t];const m=()=>!0,y=Gt();Kt(f,m,h,a.signature,y),y.entry=h,p={return:d},f=t=>null!=p[t]?p[t]:t;const g=Gt();return Kt(f,m,h,o.signature,g),g.calls=y.calls,g.entry=i,e.bodies.push(te(y).code.split(" {")[0]),e.bodies.push(te(g).code)};function se(t){const e=/([A-Za-z0-9_]+\s+)?[A-Za-z0-9_]+\s+[A-Za-z0-9_]+\s*\([^)]*\)\s*;\s*/gm,n=t=>t.replace(e,(t=>"")),s=t.split(/(?=[{}])/g);let r=0;for(let t=0;t<s.length;t++){const e=s[t];switch(e[0]){case"{":r++;break;case"}":r--}if(0===r){const r=e.split(/^[ \t]*#/m);for(let t=0;t<r.length;t++){let e=r[t];if(t>0){e=e.split(/\n/);const s=e.shift(),i=e.join("\n");r[t]=[s,n(i)].join("\n")}else r[t]=n(e)}s[t]=r.join("#")}}return s.join("")}function re(t){const e={};return t.replace(/((attribute|uniform|varying)\s+)[A-Za-z0-9_]+\s+([A-Za-z0-9_]+)\s*(\[[^\]]*\]\s*)?;\s*/gm,(function(t,n,s,r,i){return e[r]?"":(e[r]=!0,t)}))}function ie(t){const e=function(t,e){const n=[],s=[];for(const r of Array.from(t)){(r.match(e)?n:s).push(r)}return n.concat(s)};let n=t.split("\n");return n=e(n,/^#define ([^ ]+ _pg_[0-9]+_|_pg_[0-9]+_ [^ ]+)$/),n=e(n,/^#extension/),n.join("\n")}const{library:oe,cache:ae}=o,{visualize:he,inspect:ue}=i,{Snippet:le}=e,ce=function(t,e={}){const n={};for(let s in t)n[s]=e[s]||t[s];return n};class pe{constructor(t,e){this.config=ce({globalUniforms:!1,globalVaryings:!0,globalAttributes:!0,globals:[],autoInspect:!1},e),this.fetch=ae(oe(a,t,le.load))}shader(t){null==t&&(t={});const e=ce(this.config,t);return new Y(a,this.fetch,e)}material(t){return new J(this.shader(t),this.shader(t))}inspect(t){return pe.inspect(t)}visualize(t){return pe.visualize(t)}static inspect(t){return ue(t)}static visualize(t){return he(t)}}function de(t,e={}){return new pe(t,e)}pe.Block=w,pe.Factory=o,pe.GLSL=a,pe.Graph=t,pe.Linker=e,pe.Visualize=i})(),s})()}));
//# sourceMappingURL=shadergraph.min.js.map