!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ShaderGraph",[],e):"object"==typeof exports?exports.ShaderGraph=e():t.ShaderGraph=e()}(self,(function(){return(()=>{var t={706:(t,e,n)=>{var r=n(324);t.exports=function(t){for(var e=r(),n=0;n<t.length;n++)e(t[n]);return e(null)}},268:t=>{var e,n,r,s,i={nud:function(){return this.children&&this.children.length?this:y("unexpected")()},led:y("missing operator")},o={};function a(){return this}function h(t,e){var n=o[t];return e=e||0,n?e>n.lbp&&(n.lbp=e):((n=Object.create(i)).id=t,n.lbp=e,o[t]=n),n}function u(t){var e,r=n;for(m(),e=r.nud();t<n.lbp;)r=n,m(),e=r.led(e);return e}function l(t,e,n){h(t,e).led=n||function(t){return this.children=[t,u(e)],this.type="binary",this}}function c(t,e,n){var r=h(t,e);return r.led=n||function(t){return this.children=[t,u(e-1)],this.type="binary",this},r}function p(t,e){var n=h(t);return n.nud=e||function(){return this.children=[u(70)],this.type="unary",this},n}function d(t){h(t,150).led=function(t){return this.children=[t],this.type="suffix",this}}function f(t){return c(t,10,(function(t){return this.children=[t,u(9)],this.assignment=!0,this.type="assign",this}))}function m(t){var i,h,u,l;if(t&&n.data!==t)return e.unexpected("expected `"+t+"`, got `"+n.data+"`");if(!(s>=r.length)){if(h=(i=r[s++]).data,"ident"===(u=i.type))u=(l=e.scope.find(h)||e.create_node()).type;else if("builtin"===u)l=o["(builtin)"];else if("keyword"===u)l=o["(keyword)"];else if("operator"===u){if(!(l=o[h]))return e.unexpected("unknown operator `"+h+"`")}else{if("float"!==u&&"integer"!==u)return e.unexpected("unexpected token.");u="literal",l=o["(literal)"]}return l&&(l.nud||(l.nud=a),l.children||(l.children=[])),(l=Object.create(l)).token=i,l.type=u,l.data||(l.data=h),n=l}n=o["(end)"]}function y(t){return function(){return e.unexpected(t)}}h("(ident)").nud=a,h("(keyword)").nud=a,h("(builtin)").nud=a,h("(literal)").nud=a,h("(end)"),h(":"),h(";"),h(","),h(")"),h("]"),h("}"),c("&&",30),c("||",30),l("|",43),l("^",44),l("&",45),l("==",46),l("!=",46),l("<",47),l("<=",47),l(">",47),l(">=",47),l(">>",48),l("<<",48),l("+",50),l("-",50),l("*",60),l("/",60),l("%",60),l("?",20,(function(t){return this.children=[t,u(0),(m(":"),u(0))],this.type="ternary",this})),l(".",80,(function(t){return n.type="literal",e.fake(n),this.children=[t,n],m(),this})),l("[",80,(function(t){return this.children=[t,u(0)],this.type="binary",m("]"),this})),l("(",80,(function(t){if(this.children=[t],this.type="call",")"!==n.data)for(;this.children.push(u(0)),","===n.data;)m(",");return m(")"),this})),p("-"),p("+"),p("!"),p("~"),p("defined"),p("(",(function(){return this.type="group",this.children=[u(0)],m(")"),this})),p("++"),p("--"),d("++"),d("--"),f("="),f("+="),f("-="),f("*="),f("/="),f("%="),f("&="),f("|="),f("^="),f(">>="),f("<<="),t.exports=function(t,n){var i;if(e=t,s=0,(r=n).length){if(m(),(i=u(0)).parent=e[0],function t(n){e.unshift(n,!1);for(var r=0,s=n.children.length;r<s;++r)t(n.children[r]);e.shift()}(i),s<r.length)throw new Error("did not use all tokens");i.parent.children=[i]}}},324:(t,e,n)=>{t.exports=function(){var t,e,n,o,v,b,F,L,I,R,$,U,B,N=At(u),H=At(h),X=At(f),Z=At(_),G=At(a),Q=(At(M),At(c)),Y=At(p),W=At(m),J=At(g),K=At(y),tt=At(k),et=At(E),nt=At(T),rt=arguments.length?[].slice.call(arguments):[],st=!1,it=[],ot=[],at=[],ht=[],ut=!1;return it.shift=yt,it.unshift=mt,it.fake=ft,it.unexpected=Dt,it.scope=new s(it),it.create_node=function(){var t=P(a,U);return t.parent=lt.program,t},Ut(),(B=N()).expecting="(eof)",B.mode=u,B.token={type:"(program)",data:"(program)"},$=B,lt.program=$,lt.scope=function(t){return 1===arguments.length&&(it.scope=t),it.scope},it.unshift(B),lt;function lt(t){return null===t?(pt(),$):(ot=[],ct(t),ot)}function ct(r){if("whitespace"!==r.type&&"line-comment"!==r.type&&"block-comment"!==r.type)for(at.push(r),(U=U||at[0])&&ht.length&&(U.preceding=U.preceding||[],U.preceding=U.preceding.concat(ht),ht=[]);dt();)switch(it[0].mode){case h:xt();break;case u:gt();break;case d:vt();break;case f:bt();break;case x:zt();break;case l:t(!0,!0);break;case _:e();break;case a:kt();break;case w:Mt();break;case M:wt();break;case c:I();break;case p:R();break;case m:o();break;case y:F();break;case E:L();break;case k:b();break;case g:v();break;case T:n()}else ht.push(r)}function pt(t){arguments.length&&ct(t),it.length>1?Dt("unexpected EOF"):!0}function dt(){return!(ut||!it.length)&&(U=at[0])}function ft(t){it.unshift(t),it.shift()}function mt(t,e){t.parent=it[0];var n=[].unshift.call(this,t);return(e=void 0===e||e)&&B!==t&&B.children.push(t),B=t,n}function yt(){var t=[].shift.call(this),e=rt[this.length],n=!1;return rt.length?"function"==typeof rt[0]?n=rt[0](t):void 0!==e&&(n=e.test?e.test(t.type):e===t.type):n=!0,n&&!ut&&ot.push(t),B=t.parent,t}function gt(){return Vt((function(){return it.scope.enter(),i}),(function(){if(U.data===it[0].expecting)return it.scope.exit(),it.shift();switch(U.type){case"preprocessor":return it.fake(Ct()),void at.shift();default:return void it.unshift(H())}}))()}function xt(){if(it[0].brace)return"}"!==U.data?Dt("expected `}`, got "+U.data):(it[0].brace=!1,at.shift(),it.shift());switch(U.type){case"eof":return _t();case"keyword":switch(U.data){case"for":return it.unshift(W());case"if":return it.unshift(J());case"while":return it.unshift(K());case"do":return it.unshift(et());case"break":return it.fake(P(z,U)),at.shift();case"continue":return it.fake(P(A,U)),at.shift();case"discard":return it.fake(P(C,U)),at.shift();case"return":return it.unshift(tt());case"precision":return it.unshift(Z())}return it.unshift(Et(j));case"ident":var t;if(t=it.scope.find(U.data))return"struct"===t.parent.type?it.unshift(Et(j)):it.unshift(Tt(";"));case"operator":if("{"===U.data){it[0].brace=!0;var e=N();return e.expecting="}",at.shift(),it.unshift(e)}if(";"===U.data)return at.shift(),it.shift();default:return it.unshift(Tt(";"))}}function _t(){return st&&(ut=!0),st=!0,it.shift()}function vt(){var t=it[0];return Vt((function(){return"invariant"===U.data?8&t.flags?(it.unshift(jt()),i):Dt("`invariant` is not allowed here"):(it.fake(P(S,{data:"",position:U.position})),i)}),(function(){return V(U)?16&t.flags?(it.unshift(jt()),i):Dt("storage is not allowed here"):(it.fake(P(S,{data:"",position:U.position})),i)}),(function(){return O(U)?32&t.flags?Dt("parameter is not allowed here"):(it.unshift(jt()),i):(it.fake(P(S,{data:"",position:U.position})),i)}),(function(){return q(U)?(it.unshift(jt()),i):(it.fake(P(S,{data:"",position:U.position})),i)}),(function(){if("struct"===U.data)return 64&t.flags?(it.unshift(St()),i):Dt("cannot nest structs");if("keyword"===U.type)return it.unshift(jt()),i;var e=it.scope.find(U.data);if(e)return it.fake(Object.create(e)),at.shift(),i;return Dt("expected user defined type, struct or keyword, got "+U.data)}),(function(){if(","===U.data&&!(2&t.flags))return it.shift();if("["===U.data)return void it.unshift(nt());if(")"===U.data)return it.shift();if(";"===U.data)return t.stage+3;if("ident"!==U.type&&"builtin"!==U.type)return Dt("expected identifier, got "+U.data);return t.collected_name=at.shift(),i}),(function(){if("("===U.data)return at.unshift(t.collected_name),delete t.collected_name,it.unshift(Q()),t.stage+2;return i}),(function(){return at.unshift(t.collected_name),delete t.collected_name,it.unshift(X()),i}),(function(){return it.shift()}))()}function bt(){if("ident"===U.type||"builtin"===U.type){var t=U.data;return it.unshift(G()),void it.scope.define(t)}if("operator"===U.type){if(","===U.data)return 2&it[1].flags?at.shift():it.shift();if("="===U.data)return 1&it[1].flags?(at.shift(),void it.unshift(Tt(",",";"))):Dt("`=` is not allowed here.");if("["===U.data)return void it.unshift(nt())}return it.shift()}function wt(){return"keyword"===U.type?(it[0].type="keyword",void(it[0].mode=w)):"ident"===U.type?(it[0].type="ident",void(it[0].mode=a)):Dt("expected keyword or user-defined name, got "+U.data)}function Mt(){return"keyword"!==U.type?Dt("expected keyword, got "+U.data):(it.shift(),at.shift())}function kt(){return"ident"!==U.type&&"builtin"!==U.type?Dt("expected user-defined name, got "+U.data):(it[0].data=U.data,it.shift(),at.shift())}function zt(){var t=it[0].expecting;if(it[0].tokens=it[0].tokens||[],void 0===it[0].parenlevel&&(it[0].parenlevel=0,it[0].bracelevel=0),it[0].parenlevel<1&&t.indexOf(U.data)>-1)return function(t){try{r(it,t)}catch(t){throw ut=!0,t}return it.shift()}(it[0].tokens);switch("("===U.data?++it[0].parenlevel:")"===U.data&&--it[0].parenlevel,U.data){case"{":++it[0].bracelevel;break;case"}":--it[0].bracelevel;break;case"(":++it[0].parenlevel;break;case")":--it[0].parenlevel}return it[0].parenlevel<0?Dt("unexpected `)`"):it[0].bracelevel<0?Dt("unexpected `}`"):void it[0].tokens.push(at.shift())}function At(t){return function(){return P(t,U)}}function Ct(){return P(D[U.type],U)}function Et(t){var e=P(d,U);return e.flags=t,e}function St(t,e){var n=P(l,U);return n.allow_assign=void 0===t||t,n.allow_comma=void 0===e||e,n}function Tt(){var t=P(x,U);return t.expecting=[].slice.call(arguments),t}function jt(t){var e=U;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),P(w,e)}function Dt(t){throw ut=!0,new Error((t||"unexpected "+it)+" at line "+it[0].token.line)}function Ft(t,e){return Pt(t,U.type)&&Pt(e,U.data)}function Pt(t,e){switch(typeof t){case"string":return e!==t&&Dt("expected `"+t+"`, got "+e+"\n"+U.data),!ut;case"object":return t&&-1===t.indexOf(e)&&Dt("expected one of `"+t.join("`, `")+"`, got "+e),!ut}return!0}function Vt(){var t,e,n=[].slice.call(arguments);return function(){var r=it[0];return r.stage||(r.stage=0),(t=n[r.stage])?(e=t())===i?++r.stage:void(void 0!==e&&(r.stage=e)):Dt("parser in undefined state!")}}function Ot(t,e){return e=e||"operator",function(){if(Ft(e,t)){var n=at.shift(),r=it[0].children,s=r[r.length-1];return s&&s.token&&n.preceding&&(s.token.succeeding=s.token.succeeding||[],s.token.succeeding=s.token.succeeding.concat(n.preceding)),i}}}function qt(t){return function(){return it.unshift(Tt(t)),i}}function Lt(t){return t?function(){var t=U.data;return Ft("ident")&&(it.unshift(G()),it.scope.define(t),i)}:function(){if(Ft("ident"))return Object.create(it.scope.find(U.data)).token=U,at.shift(),i}}function It(){return function(){var t=N();return t.expecting="}",it.unshift(t),i}}function Rt(t){return function(){var e=it[0].stage;return"{"!==U.data?(it.unshift(H()),e+t):(at.shift(),i)}}function $t(){return function(){return it.shift(),it.shift()}}function Ut(){t=Vt(Ot("struct","keyword"),(function(){return"{"===U.data?(it.fake(P(a,{data:"",position:U.position,type:"ident"})),i):Lt(!0)()}),(function(){return it.scope.enter(),i}),Ot("{"),(function(){return"preprocessor"===U.type?(it.fake(Ct()),void at.shift()):"}"===U.data?(it.scope.exit(),at.shift(),it.shift()):void(";"!==U.data?it.unshift(Et(166)):at.shift())})),e=Vt((function(){return at.shift(),i}),(function(){return Ft("keyword",["lowp","mediump","highp"])&&(it.unshift(jt()),i)}),(function(){return it.unshift(jt()),i}),(function(){return it.shift()})),n=Vt(Ot("["),qt("]"),Ot("]"),(function(){return it.shift()})),o=Vt(Ot("for","keyword"),Ot("("),(function(){var t;if("ident"===U.type){if((t=it.scope.find(U.data))||(t=it.create_node()),"struct"===t.parent.type)return it.unshift(Et(j)),i}else if("builtin"===U.type||"keyword"===U.type)return it.unshift(Et(j)),i;return qt(";")()}),Ot(";"),qt(";"),Ot(";"),qt(")"),Ot(")"),Rt(3),It(),Ot("}"),$t()),v=Vt(Ot("if","keyword"),Ot("("),qt(")"),Ot(")"),Rt(3),It(),Ot("}"),(function(){return"else"===U.data?(at.shift(),it.unshift(H()),i):$t()()}),$t()),b=Vt(Ot("return","keyword"),(function(){return";"===U.data||it.unshift(Tt(";")),i}),(function(){at.shift(),$t()()})),F=Vt(Ot("while","keyword"),Ot("("),qt(")"),Ot(")"),Rt(3),It(),Ot("}"),$t()),L=Vt(Ot("do","keyword"),Rt(3),It(),Ot("}"),Ot("while","keyword"),Ot("("),qt(")"),Ot(")"),$t()),I=Vt((function(){for(var t=1,e=it.length;t<e;++t)if(it[t].mode===c)return Dt("function definition is not allowed within another function");return i}),(function(){if(Ft("ident")){var t=U.data,e=it.scope.find(t);return it.unshift(G()),it.scope.define(t),it.scope.enter(e?e.scope:null),i}}),Ot("("),(function(){return it.unshift(Y()),i}),Ot(")"),(function(){return";"===U.data?(it.scope.exit(),it.shift(),it.shift()):i}),Ot("{"),It(),Ot("}"),(function(){return it.scope.exit(),i}),(function(){return it.shift(),it.shift(),it.shift()})),R=Vt((function(){return"void"===U.data?(it.fake(jt()),at.shift(),i):")"!==U.data?"struct"===U.data?(it.unshift(St(false,false)),i):(it.unshift(Et(208)),i):void it.shift()}),(function(){if(","===U.data)return at.shift(),0;")"!==U.data?Dt("expected one of `,` or `)`, got "+U.data):it.shift()}))}};var r=n(268),s=n(745),i=new Object,o=0,a=o++,h=o++,u=o++,l=o++,c=o++,p=o++,d=o++,f=o++,m=o++,y=o++,g=o++,x=o++,_=o++,v=o++,b=o++,w=o++,M=o++,k=o++,z=o++,A=o++,C=o++,E=o++,S=o++,T=o++,j=255,D={"block-comment":v,"line-comment":v,preprocessor:b},F=o=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"];function P(t,e){return{mode:t,token:e,children:[],type:F[t],id:(4294967295*Math.random()).toString(16)}}function V(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function O(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function q(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}},745:t=>{function e(t){if(this.constructor!==e)return new e(t);this.state=t,this.scopes=[],this.current=null}t.exports=e;var n=e.prototype;n.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},n.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},n.define=function(t){this.current[t]=this.state[0]},n.find=function(t,e){for(var n=this.scopes.length-1;n>-1;--n)if(this.scopes[n].hasOwnProperty(t))return this.scopes[n][t];return null}},460:(t,e,n)=>{t.exports=function(t){var e,n,c,p=0,d=0,f=h,m=[],y=[],g=1,x=0,_=0,v=!1,b=!1,w="",M=i,k=r;"300 es"===(t=t||{}).version&&(M=a,k=o);var z={},A={};for(p=0;p<M.length;p++)z[M[p]]=!0;for(p=0;p<k.length;p++)A[k[p]]=!0;return function(t){return y=[],null!==t?function(t){p=0,t.toString&&(t=t.toString());var n;w+=t.replace(/\r\n/g,"\n"),c=w.length;for(;e=w[p],p<c;){switch(n=p,f){case 0:p=D();break;case 1:p=j();break;case 2:p=T();break;case 3:p=F();break;case 4:p=O();break;case 11:p=V();break;case 5:p=q();break;case u:p=L();break;case 9:p=S();break;case h:p=E()}if(n!==p)switch(w[n]){case"\n":x=0,++g;break;default:++x}}return d+=p,w=w.slice(p),y}(t):function(t){m.length&&C(m.join(""));return f=10,C("(eof)"),y}()};function C(t){t.length&&y.push({type:l[f],data:t,position:_,line:g,column:x})}function E(){return m=m.length?[]:m,"/"===n&&"*"===e?(_=d+p-1,f=0,n=e,p+1):"/"===n&&"/"===e?(_=d+p-1,f=1,n=e,p+1):"#"===e?(f=2,_=d+p,p):/\s/.test(e)?(f=9,_=d+p,p):(v=/\d/.test(e),b=/[^\w_]/.test(e),_=d+p,f=v?4:b?3:u,p)}function S(){return/[^\s]/g.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function T(){return"\r"!==e&&"\n"!==e||"\\"===n?(m.push(e),n=e,p+1):(C(m.join("")),f=h,p)}function j(){return T()}function D(){return"/"===e&&"*"===n?(m.push(e),C(m.join("")),f=h,p+1):(m.push(e),n=e,p+1)}function F(){if("."===n&&/\d/.test(e))return f=5,p;if("/"===n&&"*"===e)return f=0,p;if("/"===n&&"/"===e)return f=1,p;if("."===e&&m.length){for(;P(m););return f=5,p}if(";"===e||")"===e||"("===e){if(m.length)for(;P(m););return C(e),f=h,p+1}var t=2===m.length&&"="!==e;if(/[\w_\d\s]/.test(e)||t){for(;P(m););return f=h,p}return m.push(e),n=e,p+1}function P(t){for(var e,n,r=0;;){if(e=s.indexOf(t.slice(0,t.length+r).join("")),n=s[e],-1===e){if(r--+t.length>0)continue;n=t.slice(0,1).join("")}return C(n),_+=n.length,(m=m.slice(n.length)).length}}function V(){return/[^a-fA-F0-9]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function O(){return"."===e||/[eE]/.test(e)?(m.push(e),f=5,n=e,p+1):"x"===e&&1===m.length&&"0"===m[0]?(f=11,m.push(e),n=e,p+1):/[^\d]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function q(){return"f"===e&&(m.push(e),n=e,p+=1),/[eE]/.test(e)?(m.push(e),n=e,p+1):("-"!==e&&"+"!==e||!/[eE]/.test(n))&&/[^\d]/.test(e)?(C(m.join("")),f=h,p):(m.push(e),n=e,p+1)}function L(){if(/[^\d\w_]/.test(e)){var t=m.join("");return f=A[t]?8:z[t]?7:6,C(m.join("")),f=h,p}return m.push(e),n=e,p+1}};var r=n(529),s=n(679),i=n(222),o=n(914),a=n(537),h=999,u=9999,l=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},537:(t,e,n)=>{var r=n(222);r=r.slice().filter((function(t){return!/^(gl\_|texture)/.test(t)})),t.exports=r.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},222:t=>{t.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},914:(t,e,n)=>{var r=n(529);t.exports=r.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},529:t=>{t.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},679:t=>{t.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},932:(t,e,n)=>{var r=n(460);t.exports=function(t,e){var n=r(e),s=[];return s=(s=s.concat(n(t))).concat(n(null))}},760:(t,e)=>{e.make=function(t){return null==t&&(t=[]),t instanceof Array||(t=[null!=+t?+t:0]),t},e.nest=(t,e)=>t.concat(e),e.compare=function(t,e){for(let n=0,r=Math.min(t.length,e.length),s=0<=r;s?n<r:n>r;s?n++:n--){const r=t[n],s=e[n];if(r>s)return-1;if(r<s)return 1}return(t=t.length)>(e=e.length)?-1:t<e?1:0},e.max=function(t,n){return e.compare(t,n)>0?n:t}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{ShaderGraph:()=>pe,inspect:()=>ue,load:()=>de,visualize:()=>he});var t={};n.r(t),n.d(t,{Graph:()=>u,IN:()=>p,Node:()=>c,OUT:()=>d,Outlet:()=>l});var e={};n.r(e),n.d(e,{Layout:()=>_,Program:()=>g,Snippet:()=>f,assemble:()=>y,compare:()=>m.compare,link:()=>x,load:()=>v,make:()=>m.make,max:()=>m.max,nest:()=>m.nest});var s={};n.r(s),n.d(s,{merge:()=>B,overlay:()=>$,process:()=>P});var i={};n.r(i),n.d(i,{inspect:()=>Y,markup:()=>H,serialize:()=>N,visualize:()=>Q});var o={};n.r(o),n.d(o,{Factory:()=>W,Material:()=>K,cache:()=>nt,hash:()=>T,library:()=>tt,queue:()=>et});var a={};n.r(a),n.d(a,{P:()=>ft});var h={};n.r(h),n.d(h,{RETURN_ARG:()=>Ft,SHADOW_ARG:()=>Dt,body:()=>Gt,build:()=>te,call:()=>Kt,compile:()=>rt,dedupe:()=>se,define:()=>Qt,defuse:()=>re,fn:()=>Yt,hoist:()=>ie,invoke:()=>Wt,lines:()=>Ht,link:()=>ne,links:()=>ee,list:()=>Xt,parse:()=>Vt,same:()=>Jt,statements:()=>Zt,unshadow:()=>Nt,walk:()=>Ut});class u{static initClass(){this.index=0,this.IN=0,this.OUT=1}static id(t){return++u.index}constructor(t,e=null){this.parent=e,this.id=u.id(),this.nodes=[],t&&this.add(t)}inputs(){const t=[];for(let e of Array.from(this.nodes))for(let n of Array.from(e.inputs))null===n.input&&t.push(n);return t}outputs(){const t=[];for(let e of Array.from(this.nodes))for(let n of Array.from(e.outputs))0===n.output.length&&t.push(n);return t}getIn(t){return Array.from(this.inputs()).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs()).filter((e=>e.name===t))[0]}add(t,e){if(t.length)for(let e of Array.from(t))this.add(e);else{if(t.graph&&!e)throw new Error("Adding node to two graphs at once");t.graph=this,this.nodes.push(t)}}remove(t,e){if(t.length)for(let e of Array.from(t))this.remove(e);else{if(t.graph!==this)throw new Error("Removing node from wrong graph.");e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}}adopt(t){if(t.length)for(let e of Array.from(t))this.adopt(e);else t.graph.remove(t,!0),this.add(t,!0)}}u.initClass();class l{static initClass(){this.index=0}static make(t,e){null==e&&(e={});const n=e;if(null!=t.meta)for(let e in t.meta){const r=t.meta[e];n[e]=r}return new l(t.inout,t.name,t.hint,t.type,n)}static id(t){return`_io_${++l.index}_${t}`}static hint(t){return(t=(t=t.replace(/^_io_[0-9]+_/,"")).replace(/_i_o$/,"")).replace(/(In|Out|Inout|InOut)$/,"")}constructor(t,e,n,r,s,i){this.inout=t,this.name=e,this.hint=n,this.type=r,null==s&&(s={}),this.meta=s,this.id=i,null==this.hint&&(this.hint=l.hint(this.name)),this.node=null,this.input=null,this.output=[],null==this.id&&(this.id=l.id(this.hint))}morph(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta}dupe(t){null==t&&(t=this.id);const e=l.make(this);return e.name=t,e}connect(t){if(this.inout===u.IN&&t.inout===u.OUT)return t.connect(this);if(this.inout!==u.OUT||t.inout!==u.IN)throw new Error("Can only connect out to in.");return t.input!==this?(t.disconnect(),t.input=this,this.output.push(t)):void 0}disconnect(t){if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(t of Array.from(this.output))t.input=null;return this.output=[]}{const e=this.output.indexOf(t);if(e>=0)return this.output.splice(e,1),t.input=null}}}}l.initClass();class c{static initClass(){this.index=0}static id(t){return++c.index}constructor(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.all=[],this.outlets=null,this.id=c.id(),this.setOutlets(e)}getIn(t){return Array.from(this.inputs).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs).filter((e=>e.name===t))[0]}get(t){return this.getIn(t)||this.getOut(t)}setOutlets(t){if(null!=t){let e;if(null==this.outlets){for(e of(this.outlets={},Array.from(t)))e instanceof l||(e=l.make(e)),this._add(e);return}const n=t=>[t.name,t.inout,t.type].join("-"),r={};for(e of Array.from(t))r[n(e)]=!0;for(let t in this.outlets)e=this.outlets[t],t=n(e),r[t]?r[t]=e:this._remove(e);for(e of Array.from(t)){const t=r[n(e)];t instanceof l?this._morph(t,e):(e instanceof l||(e=l.make(e)),this._add(e))}}return this.outlets}connect(t,e,n){let r,s,i,o,a;const h={},u={},l=t=>a+"/"+t.hint;for(r of Array.from(t.inputs)){var c;!n&&r.input||(({type:a}=r),i=l(r),u[i]||(u[i]=r),h[a]=c=h[a]||[],c.push(r))}let p=this.outputs;for(o of(p=p.filter((t=>!(e&&t.output.length))),Array.from(p.slice())))({type:a}=o),i=l(o),s=h[a],(r=u[i])&&(o.connect(r),delete u[i],s.splice(s.indexOf(r),1),p.splice(p.indexOf(o),1));if(!p.length)return this;for(o of Array.from(p.slice()))({type:a}=o),s=h[a],s&&s.length&&o.connect(s.shift());return this}disconnect(t){let e;for(e of Array.from(this.inputs))e.disconnect();for(e of Array.from(this.outputs))e.disconnect();return this}_key(t){return[t.name,t.inout].join("-")}_add(t){const e=this._key(t);if(t.node)throw new Error("Adding outlet to two nodes at once.");if(this.outlets[e])throw new Error(`Adding two identical outlets to same node. (${e})`);return t.node=this,t.inout===u.IN&&this.inputs.push(t),t.inout===u.OUT&&this.outputs.push(t),this.all.push(t),this.outlets[e]=t}_morph(t,e){let n=this._key(e);return delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e}_remove(t){const e=this._key(t),{inout:n}=t;if(t.node!==this)throw new Error("Removing outlet from wrong node.");return t.disconnect(),t.node=null,delete this.outlets[e],t.inout===u.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===u.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this.all.splice(this.all.indexOf(t),1),this}}c.initClass();const{IN:p,OUT:d}=u;class f{static initClass(){this.index=0}static namespace(){return`_sn_${++f.index}_`}static load(t,e,n){const r=t.parse(e,n),[s,i]=Array.from(t.compile(r));return new f(t,s,i,e,n)}constructor(t,e,n,r,s){this.language=t,this._signatures=e,this._compiler=n,this._name=r,this._original=s,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.symbols=null,this.attributes=null,this.varyings=null,this.language||delete this.language,this._signatures||delete this._signatures,this._compiler||delete this._compiler,this._original||delete this._original,this._name||(this._name=null!=this._signatures?this._signatures.main.name:void 0)}clone(){return new f(this.language,this._signatures,this._compiler,this._name,this._original)}bind(t,e,n,r){let s,i,o;e===""+e?[n,e,r]=Array.from([e,null!=n?n:{},null!=r?r:{}]):n!==""+n&&([r,n]=Array.from([null!=n?n:{},void 0])),this.main=this._signatures.main,this.namespace=null!=(i=null!=n?n:this.namespace)?i:f.namespace(),this.entry=this.namespace+this.main.name,this.uniforms={},this.varyings={},this.attributes={},this.externals={},this.symbols=[];const a={},h={},u=function(t){return h[t]=!0,t},l=t=>this.namespace+t;if(t.globals)for(let e of Array.from(t.globals))u(e);const c=t.globalUniforms?u:l,p=t.globalVaryings?u:l,d=t.globalAttributes?u:l,m=l,y=t=>a[t.name]=!0,g=(t,e)=>this.uniforms[c(null!=e?e:t.name)]=t;o=t=>this.varyings[p(t.name)]=t;const x=t=>this.attributes[d(t.name)]=t,_=t=>{const e=m(t.name);return this.externals[e]=t,this.symbols.push(e)},v=t=>({type:t.type,name:t.name,value:t.value});for(s of Array.from(this._signatures.uniform))y(s);for(s of Array.from(this._signatures.uniform))g(v(s));for(s of Array.from(this._signatures.varying))o(v(s));for(s of Array.from(this._signatures.external))_(s);for(s of Array.from(this._signatures.attribute))x(v(s));for(let t in e)s=e[t],a[t]&&g(s,t);if(this.body=this.code=this._compiler(this.namespace,h,r),r){const t=(()=>{const t=[];for(let e in r)o=r[e],t.push(`#define ${e} ${o}`);return t})().join("\n");t.length&&(this._original=[t,"//----------------------------------------",this._original].join("\n"))}return null}}f.initClass();var m=n(760);const y=function(t,e,n,r){const s=t,i={},o=[],a={},h={},u={},l={};var c=t=>{let e;(t=(()=>{const n=[];for(let r in t)e=t[r],n.push(e);return n})()).sort(((t,e)=>e.priority-t.priority));const n=(t,e,n)=>{y(t,e,n);const{main:i}=e,{entry:o}=e;return s.call((e=>_(t,e)),(e=>x(t,e)),o,i.signature,r)};var r=s.body();for(e of Array.from(t))n(e.node,e.module,e.priority);return[r,t]};const f=function(t,e,n){const r=l[t];return null!=r?r.priority=m.max(r.priority,n):l[t]={code:e,priority:n}};var y=function(t,e,n){let r,s;n=m.make(n);for(let t in e.library){const r=e.library[t];f(t,r.code,m.nest(n,r.priority))}for(s in f(e.namespace,e.body,n),e.uniforms)r=e.uniforms[s],a[s]=r;for(s in e.varyings)r=e.varyings[s],h[s]=r;for(s in e.attributes)r=e.attributes[s],u[s]=r;return g(t,e)},g=(t,e)=>(()=>{const n=[];for(let r of Array.from(e.symbols)){const s=e.externals[r];if(x(t,s.name)){const e={};for(let t in s){const n=s[t];e[t]=n}e.name=_(t,s.name),i[r]=e,n.push(o.push(r))}else n.push(void 0)}return n})(),x=function(t,e){const n=t.get(e);return n.inout===p?null===n.input:n.inout===d?0===n.output.length:void 0},_=function(t,e){let n=t.get(e);return n?(n.input&&(n=n.input),({name:e}=n),n.id):null};return function(){let t,p;for(p in r){const t=r[p];g(t.node,t.module)}[t,n]=Array.from(c(n)),null!=e&&(t.entry=e);const d=s.build(t,n),f=(()=>{const t=[];for(p in l){const e=l[p];t.push(e)}return t})().sort(((t,e)=>m.compare(t.priority,e.priority))).map((t=>t.code));f.push(d.code);const y=s.lines(f);return{namespace:d.name,library:l,body:d.code,code:y,main:d,entry:d.name,symbols:o,externals:i,uniforms:a,varyings:h,attributes:u}}()};class g{static initClass(){this.index=0}static entry(){return`_pg_${++g.index}_`}constructor(t,e,n){this.language=t,this.namespace=e,this.graph=n,this.calls={},this.requires={}}call(t,e,n){let r;const s=e.namespace;return(r=this.calls[s])?r.priority=Math.max(r.priority,n):this.calls[s]={node:t,module:e,priority:n},this}require(t,e){const n=e.namespace;return this.requires[n]={node:t,module:e}}assemble(){const t=y(this.language,null!=this.namespace?this.namespace:g.entry,this.calls,this.requires),e=new f;for(let n in t)e[n]=t[n];return e.graph=this.graph,e}}g.initClass();const x=function(t,e,n,r){const s=t;let i=[];const o=[],a={},h={},u={},l={},c={},f=function(t,e,n){const r=c[t];return null!=r?r.priority=m.max(r.priority,n):c[t]={code:e,priority:n}};var y=function(t,e,n){let r,s;n=m.make(n);for(let t in e.library){const r=e.library[t];f(t,r.code,m.nest(n,r.priority))}for(s in f(e.namespace,e.body,n),e.uniforms)r=e.uniforms[s],h[s]=r;for(s in e.varyings)r=e.varyings[s],l[s]=r;for(s in e.attributes)r=e.attributes[s],u[s]=r;return(()=>{const n=[];for(s of Array.from(e.symbols)){const r=e.externals[s];g(t,r.name)?(a[s]=r,n.push(o.push(s))):n.push(void 0)}return n})()},g=function(t,e){const n=t.get(e);if(!n){const n=null!=(null!=t.owner.snippet?t.owner.snippet._name:void 0)?null!=t.owner.snippet?t.owner.snippet._name:void 0:t.owner.namespace;throw new Error(`Unable to link program. Unlinked callback \`${e}\` on \`${n}\``)}return n.inout===p?null===n.input:n.inout===d?0===n.output.length:void 0};return function(){const t=s.links(e),o=[];null!=t.defs&&o.push(t.defs),null!=t.bodies&&o.push(t.bodies);for(let t of Array.from(n))y(t.node,t.module,t.priority);const p=(()=>{const t=[];for(let e in c){const n=c[e];t.push(n)}return t})().sort(((t,e)=>m.compare(t.priority,e.priority)));i=p.map((t=>t.code));let d=s.lines(i);d=s.defuse(d),o.length&&(d=[s.lines(o),d].join("\n")),d=s.hoist(d),d=s.dedupe(d);const f=r;return{namespace:f.main.name,code:d,main:f.main,entry:f.main.name,externals:a,uniforms:h,attributes:u,varyings:l}}()};class _{constructor(t,e){this.language=t,this.graph=e,this.links=[],this.includes=[],this.modules={},this.visits={}}callback(t,e,n,r,s){return this.links.push({node:t,module:e,priority:n,name:r,external:s})}include(t,e,n){let r;return null!=(r=this.modules[e.namespace])?r.priority=Math.max(n,r.priority):(this.modules[e.namespace]=!0,this.includes.push({node:t,module:e,priority:n}))}visit(t){return!this.visits[t]&&(this.visits[t]=!0)}link(t){const e=x(this.language,this.links,this.includes,t),n=new f;for(let t in e)n[t]=e[t];return n.graph=this.graph,n}}const{load:v}=f;class b{static previous(t){return null!=t.input?t.input.node.owner:void 0}constructor(t){null==t&&(t=!1),t||this.construct()}construct(){let t;return null==this.namespace&&(this.namespace=g.entry()),this.node=new c(this,null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}refresh(){let t;return this.node.setOutlets(null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}clone(){return new b}compile(t,e){const n=new g(t,null!=e?e:g.entry(),this.node.graph);return this.call(n,0),n.assemble()}link(t,e){const n=this.compile(t,e),r=new _(t,this.node.graph);return this._include(n,r,0),this.export(r,0),r.link(n)}call(t,e){}callback(t,e,n,r,s){}export(t,e){}_info(t){let e=null!=(null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0)?null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0:this.node.owner.namespace;if(null!=t)return e+"."+t}_outlet(t,e){const n=l.make(t,e);return n.meta.def=t,n}_call(t,e,n){return e.call(this.node,t,n)}_require(t,e){return e.require(this.node,t)}_inputs(t,e,n){return(()=>{const r=[];for(let s of Array.from(t.main.signature)){const t=this.node.get(s.name);r.push(M(b.previous(t),(t=>t.call(e,n+1))))}return r})()}_callback(t,e,n,r,s,i){return e.callback(this.node,t,n,r,s,i)}_include(t,e,n){return e.include(this.node,t,n)}_link(t,e,n){return(()=>{const r=[];for(let s of Array.from(t.symbols)){const i=t.externals[s];let o=this.node.get(i.name);if(!o)throw new w(`External not found on ${this._info(i.name)}`);if(null!=o.meta.child)continue;let a,h=o;for(;!a&&h;)[h,o]=Array.from([o.meta.parent,h]);if(a=b.previous(o),!a)throw new w(`Missing connection on ${this._info(i.name)}`);a.callback(e,n+1,s,i,o.input),r.push(null!=a?a.export(e,n+1):void 0)}return r})()}_trace(t,e,n){return(()=>{const r=[];for(let s of Array.from(t.main.signature)){const t=this.node.get(s.name);r.push(M(b.previous(t),(t=>t.export(e,n+1))))}return r})()}}var w=function(t){const e=new Error(t);return e.name="OutletError",e};function M(t,e){return null!=t?e(t):void 0}w.prototype=new Error;class k extends b{constructor(t){super(!0),this.snippet=t,this.namespace=t.namespace,this.construct()}clone(){return new k(this.snippet)}makeOutlets(){const t=this.snippet.main.signature,{externals:e}=this.snippet,{symbols:n}=this.snippet,r=Array.from(t).map((t=>this._outlet(t,{callback:!1}))),s=Array.from(n).map((t=>this._outlet(e[t],{callback:!0})));return r.concat(s)}call(t,e){return this._call(this.snippet,t,e),this._inputs(this.snippet,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.snippet,t,e),this._trace(this.snippet,t,e)}}class z extends b{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new z(this.graph)}makeOutlets(){let t;this.make();const e=[];let n=[],r=[];const s=(t,n)=>{if(!t.meta.callback)return n.push(t.type);if(t.inout===u.IN){const n=t.dupe();return null==n.meta.child&&(n.meta.child=t),t.meta.parent=n,e.push(n)}};for(t of Array.from(this.graph.inputs()))s(t,n);for(t of Array.from(this.graph.outputs()))s(t,r);n=n.join(","),r=r.join(",");const i=`(${n})(${r})`;return e.push({name:"callback",type:i,inout:u.OUT,meta:{callback:!0,def:this.subroutine.main}}),e}make(){return this.subroutine=this.graph.compile(this.namespace)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this.graph.export(t,e)}call(t,e){return this._require(this.subroutine,t,e)}callback(t,e,n,r,s){return this._include(this.subroutine,t,e),this._callback(this.subroutine,t,e,n,r,s)}}class A extends b{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new A(this.graph)}makeOutlets(){this.make();const t=[],e={},n={};for(let r of["inputs","outputs"])for(let s of Array.from(this.graph[r]())){let r;["return","callback"].includes(s.hint)&&s.inout===u.OUT&&(r=s.hint),null!=e[r]&&(r=void 0);const i=s.dupe(r);null==i.meta.child&&(i.meta.child=s),s.meta.parent=i,null!=r&&(e[r]=!0),n[s.name]=i,t.push(i)}return t}make(){return this.subroutine=this.graph.compile(this.namespace)}call(t,e){return this._call(this.subroutine,t,e),this._inputs(this.subroutine,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this._trace(this.subroutine,t,e),this.graph.export(t,e)}callback(t,e,n,r,s){return(s=s.meta.child).node.owner.callback(t,e,n,r,s)}}class C extends b{constructor(t){super(!0),this.nodes=t,this.construct()}clone(){return new C(this.nodes)}makeOutlets(){return[]}call(t,e){return(()=>{const n=[];for(let r of Array.from(this.nodes)){const s=r.owner;n.push(s.call(t,e))}return n})()}export(t,e){return(()=>{const n=[];for(let r of Array.from(this.nodes)){const s=r.owner;n.push(s.export(t,e))}return n})()}}var E=function(t){const e=[],n=[];for(let s of Array.from(t.nodes)){var r;const t={id:s.id,name:null,type:null,depth:null,graph:null,inputs:[],outputs:[]};e.push(t);const{inputs:i}=t,{outputs:o}=t,a=s.owner;a instanceof k?(t.name=a.snippet._name,t.type="call",t.code=a.snippet._original):a instanceof z?(t.name="Callback",t.type="callback",t.graph=E(a.graph)):a instanceof A?(t.name="Isolate",t.type="isolate",t.graph=E(a.graph)):a instanceof C?(t.name="Join",t.type="join"):null!=a&&(null==t.name&&(t.name=null!=a.name?a.name:a.type),null==t.type&&(t.type=a.type),null==t.code&&(t.code=a.code),null!=a.graph&&(t.graph=E(a.graph)));const h=function(t){return(t=t.replace(")(",")→(")).replace("()","")};for(r of Array.from(s.inputs))i.push({id:r.id,name:r.name,type:h(r.type),open:null==r.input});for(r of Array.from(s.outputs)){o.push({id:r.id,name:r.name,type:h(r.type),open:!r.output.length});for(let t of Array.from(r.output))n.push({from:s.id,out:r.id,to:t.node.id,in:t.id,type:h(r.type)})}}return{nodes:e,links:n}};let S=function(t,e){const n=65535&t,r=65535&e;return n*r+((t>>>16&65535)*r+n*(e>>>16&65535)<<16>>>0)|0};if(null!=Math.imul){-5===Math.imul(4294967295,5)&&({imul:S}=Math)}const T=function(t){let e;const n=t.length;let r=Math.floor(n/2),s=e=0;const i=()=>t.charCodeAt(s++),o=function(t,n){let r=t|n<<16;return r^=r<<9,r=S(r,3432918353),r=r<<15|r>>>17,r=S(r,461845907),e^=r,e=e<<13|e>>>19,e=S(e,5),e=e+3864292196|0};for(;r--;)o(i(),i());return 1&n&&o(i(),0),e^=n,e^=e>>>16,e=S(e,2246822507),e^=e>>>13,e=S(e,3266489909),e^=e>>>16},j=t=>(""+t).replace(/^\s+|\s+$/g,""),D=function(t,e){null==e&&(e=1);const n=1193046^T(t);let r=255&n,s=n>>>8&255,i=n>>>16&255;const o=Math.max(r,s,i),a=140/o,h=Math.round(o/3);return r=Math.min(255,Math.round(a*Math.max(r,h))),s=Math.min(255,Math.round(a*Math.max(s,h))),i=Math.min(255,Math.round(a*Math.max(i,h))),((t,e,n,r)=>"rgba("+[t,e,n,r].join(", ")+")")(r,s,i,e)},F=function(t){return(t=null!=t?t:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},P=function(t){const e=[],n=O(t,e);return n.update=()=>R(n,e),V(n),n};var V=function(t){const e=t.querySelectorAll(".shadergraph-code");return Array.from(e).map((t=>function(){const e=t;return e.parentNode.classList.add("shadergraph-has-code"),e.parentNode.addEventListener("click",(t=>e.style.display={block:"none",none:"block"}[e.style.display||"none"]))}()))};var O=function(t,e){let n;!function(t){let e,n;const r={},s={};for(n of Array.from(t.nodes))r[n.id]=n;for(e of Array.from(t.links))null==s[e.from]&&(s[e.from]=[]),s[e.from].push(e);var i=function(t,n){let o;if(null==n&&(n=0),t.depth=Math.max(null!=t.depth?t.depth:0,n),o=s[t.id])for(e of Array.from(o))i(r[e.to],n+1);return null};for(n of Array.from(t.nodes))null==n.depth&&i(n)}(t);const r=document.createElement("div");r.classList.add("shadergraph-graph");const s=[],i={};for(let r of Array.from(t.nodes)){var o,a=document.createElement("div");a.classList.add("shadergraph-node"),a.classList.add(`shadergraph-node-${r.type}`),a.innerHTML=`<div class="shadergraph-header">${F(r.name)}</div>`;const t=function(t,e){const n=D(t.type),r=document.createElement("div");return r.classList.add("shadergraph-outlet"),r.classList.add(`shadergraph-outlet-${e}`),r.innerHTML=`<div class="shadergraph-point" style="background: ${n}"></div>\n<div class="shadergraph-type" style="color: ${n}">${F(t.type)}</div>\n<div class="shadergraph-name">${F(t.name)}</div>`,a.appendChild(r),i[t.id]=r.querySelector(".shadergraph-point")};for(o of Array.from(r.inputs))t(o,"in");for(o of Array.from(r.outputs))t(o,"out");if(null!=r.graph)a.appendChild(O(r.graph,e));else{const t=document.createElement("div");t.classList.add("shadergraph-clear"),a.appendChild(t)}if(null!=r.code){const t=document.createElement("div");t.classList.add("shadergraph-code"),t.innerHTML=F(j(r.code)),a.appendChild(t)}n=s[r.depth],null==n&&(n=document.createElement("div"),n.classList.add("shadergraph-column"),s[r.depth]=n),n.appendChild(a)}for(n of Array.from(s))null!=n&&r.appendChild(n);for(let n of Array.from(t.links)){const t=D(n.type);e.push({color:t,out:i[n.out],in:i[n.in]})}return r};const q=t=>t*t,L=function(t,e,n,r){let s;const i=n-t,o=r-e,a=Math.sqrt(q(i)+q(o));if(Math.abs(o)>Math.abs(i)){const h=(t+n)/2,u=(e+r)/2,l=o>0?.3:-.3;return s=Math.min(Math.abs(i)/2,20+a/8),["M",t,e,"C",t+s,e+",",h,u-a*l,h,u,"C",h,u+a*l,n-s,r+",",n,r].join(" ")}return s=Math.min(Math.abs(i)/2.5,20+a/4),["M",t,e,"C",t+s,e+",",n-s,r+",",n,r].join(" ")},I=function(t){return null==t&&(t="svg"),document.createElementNS("http://www.w3.org/2000/svg",t)};var R=function(t,e){let n;if(null==t.parentNode)return;const r=t.getBoundingClientRect();for(n of Array.from(e)){const t=n.out.getBoundingClientRect(),e=n.in.getBoundingClientRect();n.coords={x1:(t.left+t.right)/2-r.left,y1:(t.top+t.bottom)/2-r.top,x2:(e.left+e.right)/2-r.left,y2:(e.top+e.bottom)/2-r.top}}let s=t.querySelector("svg");null!=s&&t.removeChild(s);let i=t;for(;i.parentNode&&0===i.offsetHeight;)i=i.parentNode;for(n of(s=I(),s.setAttribute("width",i.offsetWidth),s.setAttribute("height",i.offsetHeight),Array.from(e))){const t=n.coords,e=I("path");e.setAttribute("d",L(t.x1,t.y1,t.x2,t.y2)),e.setAttribute("stroke",n.color),e.setAttribute("stroke-width",3),e.setAttribute("fill","transparent"),s.appendChild(e)}return t.appendChild(s)};const $=function(t){const e=document.createElement("div");e.setAttribute("class","shadergraph-overlay");const n=document.createElement("div");n.setAttribute("class","shadergraph-close"),n.innerHTML="&times;";const r=document.createElement("div");r.setAttribute("class","shadergraph-view");const s=document.createElement("div");return s.setAttribute("class","shadergraph-inside"),s.appendChild(t),r.appendChild(s),e.appendChild(r),e.appendChild(n),n.addEventListener("click",(()=>e.parentNode.removeChild(e))),e},U=function(t){if(t instanceof Node)return t;const e=document.createElement("span");return e.innerText=null!=t?t:"",e},B=function(t){if(1!==t.length){let e;const n=document.createElement("div");for(e of Array.from(t))n.appendChild(U(e));return n.update=()=>(()=>{const n=[];for(e of Array.from(t))n.push("function"==typeof e.update?e.update():void 0);return n})(),n}return U(t[0])},N=E,H=s,X=function(t){if(!t)return;if(!t.nodes)return t;const e=N(t);return H.process(e)};var Z=function(t){return null==t?t:t instanceof Array?t.map(Z):null!=t.vertex&&null!=t.fragment?[Z(t.vertex,Z(t.fragment))]:null!=t._graph?t._graph:null!=t.graph?t.graph:t},G=function(t){let e=[];for(let n of Array.from(t))n instanceof Array?e=e.concat(G(n)):null!=n&&e.push(n);return e};const Q=function(){const t=G(Z([].slice.call(arguments)));return H.merge(Array.from(t).filter((t=>t)).map((t=>X(t))))},Y=function(){const t=Q.apply(null,arguments),e=H.overlay(t);for(let t of Array.from(document.querySelectorAll(".shadergraph-overlay")))t.remove();return document.body.appendChild(e),t.update(),e};class W{constructor(t,e,n){this.language=t,this.fetch=e,this.config=n,this.graph()}pipe(t,e,n,r){return t instanceof W?this._concat(t):null!=t&&this._call(t,e,n,r),this}call(t,e,n,r){return this.pipe(t,e,n,r)}require(t,e,n,r){return t instanceof W?this._import(t):null!=t&&(this.callback(),this._call(t,e,n,r),this.end()),this}import(t,e,n,r){return this.require(t,e,n,r)}split(){return this._group("_combine",!0),this}fan(){return this._group("_combine",!1),this}isolate(){return this._group("_isolate"),this}callback(){return this._group("_callback"),this}next(){return this._next(),this}pass(){const t=this._stack[2].end;return this.end(),this._state.end=this._state.end.concat(t),this}end(){const[t,e]=Array.from(this._exit()),{op:n}=t;return this[n]&&this[n](t,e),this}join(){return this.end()}graph(){for(;(null!=this._stack?this._stack.length:void 0)>1;)this.end();this._graph&&this._tail(this._state,this._graph);const t=this._graph;return this._graph=new u,this._state=new J,this._stack=[this._state],t}compile(t){return null==t&&(t="main"),this.graph().compile(t)}link(t){return null==t&&(t="main"),this.graph().link(t)}serialize(){return N(this._graph)}empty(){return 0===this._graph.nodes.length}_concat(t){let e;if(0===t._state.nodes.length)return this;this._tail(t._state,t._graph);try{e=new A(t._graph)}catch(e){throw this.config.autoInspect&&Y(e,this._graph,t),e}return this._auto(e),this}_import(t){let e;if(0===t._state.nodes.length)throw"Can't import empty callback";this._tail(t._state,t._graph);try{e=new z(t._graph)}catch(e){throw this.config.autoInspect&&Y(e,this._graph,t),e}return this._auto(e),this}_combine(t,e){for(let n of Array.from(t.start))for(let r of Array.from(e.end))r.connect(n,t.multi);return e.end=t.end,e.nodes=e.nodes.concat(t.nodes)}_isolate(t,e){if(t.nodes.length){let e;const n=this._subgraph(t);this._tail(t,n);try{e=new A(n)}catch(t){throw this.config.autoInspect&&Y(t,this._graph,n),t}return this._auto(e)}}_callback(t,e){if(t.nodes.length){let e;const n=this._subgraph(t);this._tail(t,n);try{e=new z(n)}catch(t){throw this.config.autoInspect&&Y(t,this._graph,n),t}return this._auto(e)}}_call(t,e,n,r){const s=this.fetch(t);s.bind(this.config,e,n,r);const i=new k(s);return this._auto(i)}_subgraph(t){const e=new u(null,this._graph);return e.adopt(t.nodes),e}_tail(t,e){let n=t.end.concat(t.tail);if(n=n.filter(((t,e)=>n.indexOf(t)===e)),n.length>1&&(n=new C(n),n=[n.node],this._graph.add(n)),e.tail=n[0],t.end=n,t.tail=[],!e.tail)throw new Error("Cannot finalize empty graph");return e.compile=t=>{null==t&&(t="main");try{return e.tail.owner.compile(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.link=t=>{null==t&&(t="main");try{return e.tail.owner.link(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.export=(t,n)=>e.tail.owner.export(t,n),e.inspect=(t=null)=>Y(t,e)}_group(t,e){return this._push(t,e),this._push(),this}_next(){const t=this._pop();return this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._state.tail=this._state.tail.concat(t.tail),this._push()}_exit(){return this._next(),this._pop(),[this._pop(),this._state]}_push(t,e){return this._stack.unshift(new J(t,e)),this._state=this._stack[0]}_pop(){let t;return this._state=this._stack[1],null==this._state&&(this._state=new J),null!=(t=this._stack.shift())?t:new J}_auto(t){return t.node.inputs.length?this._append(t):this._insert(t)}_append(t){let e;const{node:n}=t;for(e of(this._graph.add(n),Array.from(this._state.end)))e.connect(n);this._state.start.length||(this._state.start=[n]),this._state.end=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_prepend(t){let e;const{node:n}=t;for(e of(this._graph.add(n),Array.from(this._state.start)))n.connect(e);this._state.end.length||(this._state.end=[n]),this._state.start=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_insert(t){const{node:e}=t;if(this._graph.add(e),this._state.start.push(e),this._state.end.push(e),this._state.nodes.push(e),!e.outputs.length)return this._state.tail.push(e)}}class J{constructor(t=null,e,n,r,s,i){this.op=t,null==e&&(e=!1),this.multi=e,null==n&&(n=[]),this.start=n,null==r&&(r=[]),this.end=r,null==s&&(s=[]),this.nodes=s,null==i&&(i=[]),this.tail=i}}class K{constructor(t,e){this.vertex=t,this.fragment=e}build(t){return this.link(t)}link(t){null==t&&(t={});const e={},n={},r={},s=this.vertex.link("main"),i=this.fragment.link("main");for(let t of[s,i]){var o,a;for(o in t.uniforms)a=t.uniforms[o],e[o]=a;for(o in t.varyings)a=t.varyings[o],n[o]=a;for(o in t.attributes)a=t.attributes[o],r[o]=a}return t.vertexShader=s.code,t.vertexGraph=s.graph,t.fragmentShader=i.code,t.fragmentGraph=i.graph,t.attributes=r,t.uniforms=e,t.varyings=n,t.inspect=()=>Y("Vertex Shader",s,"Fragment Shader",i.graph),t}inspect(){return Y("Vertex Shader",this.vertex,"Fragment Shader",this.fragment.graph)}}const tt=function(t,e,n){let r=null,s={};null!=e&&("function"==typeof e?r=r=>n(t,r,e(r)):"object"==typeof e&&(r=function(r){if(null==e[r])throw new Error(`Unknown snippet \`${r}\``);return n(t,r,e[r])}));const i=e=>n(t,"",e);if(null==r)return i;const o=function(t){return t.match(/[{;]/)?i(t):(s[t]=!0,r(t))};return o.used=function(t){return null==t&&(t=s),s=t},o},et=function(t){null==t&&(t=100);const e={};let n=null,r=null,s=0;const i=function(t){if(t.prev=null,t.next=n,null!=n&&(n.prev=t),n=t,null==r)return r=t},o=function(t){const{prev:e}=t,{next:s}=t;if(null!=e&&(e.next=s),null!=s&&(s.prev=e),n===t&&(n=s),r===t)return r=e};return function(a){let h,u;return(u=e[a])&&u!==n?(o(u),i(u)):(s===t?(h=r.key,o(r),delete e[h]):s++,u={next:n,prev:null,key:a},i(u),e[a]=u),h}},nt=function(t){const e={},n=et(100);return function(r){const s=r.length>32?"##"+T(r).toString(16):r,i=n(s);return null!=i&&delete e[i],null==e[s]&&(e[s]=t(r)),e[s].clone()}},rt=function(t){const{ast:e,code:n,signatures:r}=t,s=st(r);return[r,it(n,s)]};var st=function(t){const e={},n=t=>e[t.name]=!0;n(t.main);for(let e of["external","internal","varying","uniform","attribute"])for(let r of t[e])n(r);return e},it=function(t,e){let n;const r=new RegExp("\\b("+(()=>{const t=[];for(n in e)t.push(n);return t})().join("|")+")\\b","g");return t=(t=t.replace(/\/\/[^\n]*/g,"")).replace(/\/\*([^*]|\*[^\/])*\*\//g,""),function(n,s,i){let o;null==n&&(n=""),null==s&&(s={}),null==i&&(i={});const a={};for(o in e)a[o]=null!=s[o]?o:n+o;const h=t.replace(r,(t=>a[t])),u=(()=>{const t=[];for(o in i){const e=i[o];t.push(`#define ${o} ${e}`)}return t})();return u.length&&u.push(""),u.join("\n")+h}},ot=n(932),at=n.n(ot),ht=n(706),ut=n.n(ht);class lt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),s=this.x-t.x,i=this.y-t.y;return this.x=s*n-i*r+t.x,this.y=s*r+i*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}lt.prototype.isVector2=!0;const ct=[];for(let t=0;t<256;t++)ct[t]=(t<16?"0":"")+t.toString(16);Math.PI,Math.PI;function pt(t,e,n){return Math.max(e,Math.min(n,t))}class dt{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,s,i,o){let a=n[r+0],h=n[r+1],u=n[r+2],l=n[r+3];const c=s[i+0],p=s[i+1],d=s[i+2],f=s[i+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=u,void(t[e+3]=l);if(1===o)return t[e+0]=c,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(l!==f||a!==c||h!==p||u!==d){let t=1-o;const e=a*c+h*p+u*d+l*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const s=Math.sqrt(r),i=Math.atan2(s,e*n);t=Math.sin(t*i)/s,o=Math.sin(o*i)/s}const s=o*n;if(a=a*t+c*s,h=h*t+p*s,u=u*t+d*s,l=l*t+f*s,t===1-o){const t=1/Math.sqrt(a*a+h*h+u*u+l*l);a*=t,h*=t,u*=t,l*=t}}t[e]=a,t[e+1]=h,t[e+2]=u,t[e+3]=l}static multiplyQuaternionsFlat(t,e,n,r,s,i){const o=n[r],a=n[r+1],h=n[r+2],u=n[r+3],l=s[i],c=s[i+1],p=s[i+2],d=s[i+3];return t[e]=o*d+u*l+a*p-h*c,t[e+1]=a*d+u*c+h*l-o*p,t[e+2]=h*d+u*p+o*c-a*l,t[e+3]=u*d-o*l-a*c-h*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,s=t._z,i=t._order,o=Math.cos,a=Math.sin,h=o(n/2),u=o(r/2),l=o(s/2),c=a(n/2),p=a(r/2),d=a(s/2);switch(i){case"XYZ":this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d;break;case"YXZ":this._x=c*u*l+h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d;break;case"ZXY":this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l-c*p*d;break;case"ZYX":this._x=c*u*l-h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l+c*p*d;break;case"YZX":this._x=c*u*l+h*p*d,this._y=h*p*l+c*u*d,this._z=h*u*d-c*p*l,this._w=h*u*l-c*p*d;break;case"XZY":this._x=c*u*l-h*p*d,this._y=h*p*l-c*u*d,this._z=h*u*d+c*p*l,this._w=h*u*l+c*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],s=e[8],i=e[1],o=e[5],a=e[9],h=e[2],u=e[6],l=e[10],c=n+o+l;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(u-a)*t,this._y=(s-h)*t,this._z=(i-r)*t}else if(n>o&&n>l){const t=2*Math.sqrt(1+n-o-l);this._w=(u-a)/t,this._x=.25*t,this._y=(r+i)/t,this._z=(s+h)/t}else if(o>l){const t=2*Math.sqrt(1+o-n-l);this._w=(s-h)/t,this._x=(r+i)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+l-n-o);this._w=(i-r)/t,this._x=(s+h)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(pt(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,s=t._z,i=t._w,o=e._x,a=e._y,h=e._z,u=e._w;return this._x=n*u+i*o+r*h-s*a,this._y=r*u+i*a+s*o-n*h,this._z=s*u+i*h+n*a-r*o,this._w=i*u-n*o-r*a-s*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,s=this._z,i=this._w;let o=i*t._w+n*t._x+r*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=i,this._x=n,this._y=r,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*i+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(a),u=Math.atan2(h,o),l=Math.sin((1-e)*u)/h,c=Math.sin(e*u)/h;return this._w=i*l+this._w*c,this._x=n*l+this._x*c,this._y=r*l+this._y*c,this._z=s*l+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}dt.prototype.isQuaternion=!0;class ft{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(yt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(yt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*r,this.y=s[1]*e+s[4]*n+s[7]*r,this.z=s[2]*e+s[5]*n+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,s=t.elements,i=1/(s[3]*e+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*r+s[12])*i,this.y=(s[1]*e+s[5]*n+s[9]*r+s[13])*i,this.z=(s[2]*e+s[6]*n+s[10]*r+s[14])*i,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,s=t.x,i=t.y,o=t.z,a=t.w,h=a*e+i*r-o*n,u=a*n+o*e-s*r,l=a*r+s*n-i*e,c=-s*e-i*n-o*r;return this.x=h*a+c*-s+u*-o-l*-i,this.y=u*a+c*-i+l*-s-h*-o,this.z=l*a+c*-o+h*-i-u*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r,this.y=s[1]*e+s[5]*n+s[9]*r,this.z=s[2]*e+s[6]*n+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,s=t.z,i=e.x,o=e.y,a=e.z;return this.x=r*a-s*o,this.y=s*i-n*a,this.z=n*o-r*i,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return mt.copy(this).projectOnVector(t),this.sub(mt)}reflect(t){return this.sub(mt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(pt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ft.prototype.isVector3=!0;const mt=new ft,yt=new dt;class gt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,s,i,o,a,h){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=s,u[5]=a,u[6]=n,u[7]=i,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,s=this.elements,i=n[0],o=n[3],a=n[6],h=n[1],u=n[4],l=n[7],c=n[2],p=n[5],d=n[8],f=r[0],m=r[3],y=r[6],g=r[1],x=r[4],_=r[7],v=r[2],b=r[5],w=r[8];return s[0]=i*f+o*g+a*v,s[3]=i*m+o*x+a*b,s[6]=i*y+o*_+a*w,s[1]=h*f+u*g+l*v,s[4]=h*m+u*x+l*b,s[7]=h*y+u*_+l*w,s[2]=c*f+p*g+d*v,s[5]=c*m+p*x+d*b,s[8]=c*y+p*_+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return e*i*u-e*o*h-n*s*u+n*o*a+r*s*h-r*i*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=u*i-o*h,c=o*a-u*s,p=h*s-i*a,d=e*l+n*c+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=l*f,t[1]=(r*h-u*n)*f,t[2]=(o*n-r*i)*f,t[3]=c*f,t[4]=(u*e-r*a)*f,t[5]=(r*s-o*e)*f,t[6]=p*f,t[7]=(n*a-h*e)*f,t[8]=(i*e-n*s)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,s,i,o){const a=Math.cos(s),h=Math.sin(s);return this.set(n*a,n*h,-n*(a*i+h*o)+i+t,-r*h,r*a,-r*(-h*i+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,s=r[0],i=r[3],o=r[6],a=r[1],h=r[4],u=r[7];return r[0]=e*s+n*a,r[3]=e*i+n*h,r[6]=e*o+n*u,r[1]=-n*s+e*a,r[4]=-n*i+e*h,r[7]=-n*o+e*u,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}gt.prototype.isMatrix3=!0;class xt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,s,i,o,a,h,u,l,c,p,d,f,m){const y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=s,y[5]=i,y[9]=o,y[13]=a,y[2]=h,y[6]=u,y[10]=l,y[14]=c,y[3]=p,y[7]=d,y[11]=f,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new xt).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/_t.setFromMatrixColumn(t,0).length(),s=1/_t.setFromMatrixColumn(t,1).length(),i=1/_t.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*i,e[9]=n[9]*i,e[10]=n[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,s=t.z,i=Math.cos(n),o=Math.sin(n),a=Math.cos(r),h=Math.sin(r),u=Math.cos(s),l=Math.sin(s);if("XYZ"===t.order){const t=i*u,n=i*l,r=o*u,s=o*l;e[0]=a*u,e[4]=-a*l,e[8]=h,e[1]=n+r*h,e[5]=t-s*h,e[9]=-o*a,e[2]=s-t*h,e[6]=r+n*h,e[10]=i*a}else if("YXZ"===t.order){const t=a*u,n=a*l,r=h*u,s=h*l;e[0]=t+s*o,e[4]=r*o-n,e[8]=i*h,e[1]=i*l,e[5]=i*u,e[9]=-o,e[2]=n*o-r,e[6]=s+t*o,e[10]=i*a}else if("ZXY"===t.order){const t=a*u,n=a*l,r=h*u,s=h*l;e[0]=t-s*o,e[4]=-i*l,e[8]=r+n*o,e[1]=n+r*o,e[5]=i*u,e[9]=s-t*o,e[2]=-i*h,e[6]=o,e[10]=i*a}else if("ZYX"===t.order){const t=i*u,n=i*l,r=o*u,s=o*l;e[0]=a*u,e[4]=r*h-n,e[8]=t*h+s,e[1]=a*l,e[5]=s*h+t,e[9]=n*h-r,e[2]=-h,e[6]=o*a,e[10]=i*a}else if("YZX"===t.order){const t=i*a,n=i*h,r=o*a,s=o*h;e[0]=a*u,e[4]=s-t*l,e[8]=r*l+n,e[1]=l,e[5]=i*u,e[9]=-o*u,e[2]=-h*u,e[6]=n*l+r,e[10]=t-s*l}else if("XZY"===t.order){const t=i*a,n=i*h,r=o*a,s=o*h;e[0]=a*u,e[4]=-l,e[8]=h*u,e[1]=t*l+s,e[5]=i*u,e[9]=n*l-r,e[2]=r*l-n,e[6]=o*u,e[10]=s*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(bt,t,wt)}lookAt(t,e,n){const r=this.elements;return zt.subVectors(t,e),0===zt.lengthSq()&&(zt.z=1),zt.normalize(),Mt.crossVectors(n,zt),0===Mt.lengthSq()&&(1===Math.abs(n.z)?zt.x+=1e-4:zt.z+=1e-4,zt.normalize(),Mt.crossVectors(n,zt)),Mt.normalize(),kt.crossVectors(zt,Mt),r[0]=Mt.x,r[4]=kt.x,r[8]=zt.x,r[1]=Mt.y,r[5]=kt.y,r[9]=zt.y,r[2]=Mt.z,r[6]=kt.z,r[10]=zt.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,s=this.elements,i=n[0],o=n[4],a=n[8],h=n[12],u=n[1],l=n[5],c=n[9],p=n[13],d=n[2],f=n[6],m=n[10],y=n[14],g=n[3],x=n[7],_=n[11],v=n[15],b=r[0],w=r[4],M=r[8],k=r[12],z=r[1],A=r[5],C=r[9],E=r[13],S=r[2],T=r[6],j=r[10],D=r[14],F=r[3],P=r[7],V=r[11],O=r[15];return s[0]=i*b+o*z+a*S+h*F,s[4]=i*w+o*A+a*T+h*P,s[8]=i*M+o*C+a*j+h*V,s[12]=i*k+o*E+a*D+h*O,s[1]=u*b+l*z+c*S+p*F,s[5]=u*w+l*A+c*T+p*P,s[9]=u*M+l*C+c*j+p*V,s[13]=u*k+l*E+c*D+p*O,s[2]=d*b+f*z+m*S+y*F,s[6]=d*w+f*A+m*T+y*P,s[10]=d*M+f*C+m*j+y*V,s[14]=d*k+f*E+m*D+y*O,s[3]=g*b+x*z+_*S+v*F,s[7]=g*w+x*A+_*T+v*P,s[11]=g*M+x*C+_*j+v*V,s[15]=g*k+x*E+_*D+v*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],s=t[12],i=t[1],o=t[5],a=t[9],h=t[13],u=t[2],l=t[6],c=t[10],p=t[14];return t[3]*(+s*a*l-r*h*l-s*o*c+n*h*c+r*o*p-n*a*p)+t[7]*(+e*a*p-e*h*c+s*i*c-r*i*p+r*h*u-s*a*u)+t[11]*(+e*h*l-e*o*p-s*i*l+n*i*p+s*o*u-n*h*u)+t[15]*(-r*o*u-e*a*l+e*o*c+r*i*l-n*i*c+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],p=t[11],d=t[12],f=t[13],m=t[14],y=t[15],g=l*m*h-f*c*h+f*a*p-o*m*p-l*a*y+o*c*y,x=d*c*h-u*m*h-d*a*p+i*m*p+u*a*y-i*c*y,_=u*f*h-d*l*h+d*o*p-i*f*p-u*o*y+i*l*y,v=d*l*a-u*f*a-d*o*c+i*f*c+u*o*m-i*l*m,b=e*g+n*x+r*_+s*v;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=g*w,t[1]=(f*c*s-l*m*s-f*r*p+n*m*p+l*r*y-n*c*y)*w,t[2]=(o*m*s-f*a*s+f*r*h-n*m*h-o*r*y+n*a*y)*w,t[3]=(l*a*s-o*c*s-l*r*h+n*c*h+o*r*p-n*a*p)*w,t[4]=x*w,t[5]=(u*m*s-d*c*s+d*r*p-e*m*p-u*r*y+e*c*y)*w,t[6]=(d*a*s-i*m*s-d*r*h+e*m*h+i*r*y-e*a*y)*w,t[7]=(i*c*s-u*a*s+u*r*h-e*c*h-i*r*p+e*a*p)*w,t[8]=_*w,t[9]=(d*l*s-u*f*s-d*n*p+e*f*p+u*n*y-e*l*y)*w,t[10]=(i*f*s-d*o*s+d*n*h-e*f*h-i*n*y+e*o*y)*w,t[11]=(u*o*s-i*l*s-u*n*h+e*l*h+i*n*p-e*o*p)*w,t[12]=v*w,t[13]=(u*f*r-d*l*r+d*n*c-e*f*c-u*n*m+e*l*m)*w,t[14]=(d*o*r-i*f*r-d*n*a+e*f*a+i*n*m-e*o*m)*w,t[15]=(i*l*r-u*o*r+u*n*a-e*l*a-i*n*c+e*o*c)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,s=t.z;return e[0]*=n,e[4]*=r,e[8]*=s,e[1]*=n,e[5]*=r,e[9]*=s,e[2]*=n,e[6]*=r,e[10]*=s,e[3]*=n,e[7]*=r,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),s=1-n,i=t.x,o=t.y,a=t.z,h=s*i,u=s*o;return this.set(h*i+n,h*o-r*a,h*a+r*o,0,h*o+r*a,u*o+n,u*a-r*i,0,h*a-r*o,u*a+r*i,s*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,s,i){return this.set(1,n,s,0,t,1,i,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,s=e._x,i=e._y,o=e._z,a=e._w,h=s+s,u=i+i,l=o+o,c=s*h,p=s*u,d=s*l,f=i*u,m=i*l,y=o*l,g=a*h,x=a*u,_=a*l,v=n.x,b=n.y,w=n.z;return r[0]=(1-(f+y))*v,r[1]=(p+_)*v,r[2]=(d-x)*v,r[3]=0,r[4]=(p-_)*b,r[5]=(1-(c+y))*b,r[6]=(m+g)*b,r[7]=0,r[8]=(d+x)*w,r[9]=(m-g)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let s=_t.set(r[0],r[1],r[2]).length();const i=_t.set(r[4],r[5],r[6]).length(),o=_t.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],vt.copy(this);const a=1/s,h=1/i,u=1/o;return vt.elements[0]*=a,vt.elements[1]*=a,vt.elements[2]*=a,vt.elements[4]*=h,vt.elements[5]*=h,vt.elements[6]*=h,vt.elements[8]*=u,vt.elements[9]*=u,vt.elements[10]*=u,e.setFromRotationMatrix(vt),n.x=s,n.y=i,n.z=o,this}makePerspective(t,e,n,r,s,i){void 0===i&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*s/(e-t),h=2*s/(n-r),u=(e+t)/(e-t),l=(n+r)/(n-r),c=-(i+s)/(i-s),p=-2*i*s/(i-s);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,s,i){const o=this.elements,a=1/(e-t),h=1/(n-r),u=1/(i-s),l=(e+t)*a,c=(n+r)*h,p=(i+s)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}xt.prototype.isMatrix4=!0;const _t=new ft,vt=new xt,bt=new ft(0,0,0),wt=new ft(1,1,1),Mt=new ft,kt=new ft,zt=new ft;let At={in:0,out:1,inout:2};const Ct=t=>t.token.data;At.node=function(t){return"function"===(null!=t.children[5]?t.children[5].type:void 0)?At.function(t):"keyword"===(null!=t.token?t.token.type:void 0)?At.external(t):void 0},At.external=function(t){let e=t.children,n=Ct(e[1]);Ct(e[3]);const r=Ct(e[4]),s=e[5];["attribute","uniform","varying"].includes(n)||(n="global");const i=[];for(let t=0;t<s.children.length;t++)if(e=s.children[t],"ident"===e.type){const o=Ct(e),a=s.children[t+1],h="quantifier"===(null!=a?a.type:void 0);i.push({decl:"external",storage:n,type:r,ident:o,quant:!!h,count:h})}return i},At.function=function(t){const e=t.children,n=Ct(e[1]),r=(Ct(e[3]),Ct(e[4])),s=e[5],i=Ct(s.children[0]),o=s.children[1];return[{decl:"function",storage:n,type:r,ident:i,body:!!s.children[2],args:Array.from(o.children).map((t=>At.argument(t)))}]},At.argument=function(t){const e=t.children,n=Ct(e[1]),r=Ct(e[2]),s=Ct(e[4]),i=e[5],o=Ct(i.children[0]),a=i.children[1];return{decl:"argument",storage:n,inout:r,type:s,ident:o,quant:!!a,count:a?a.children[0].token.data:void 0}},At.param=function(t,e,n,r,s){let i=[];null!=e&&i.push(e),null!=n&&i.push(n),i.push(""),i=i.join(" ");const o=r?"["+s+"]":"";""!==t&&(t+=" ");const a=(e,n)=>(n?t:"")+`${i}${e}${o}`;return a.split=t=>At.param(t,e,n,r,s),a};const Et="undefined"!=typeof window&&!!window.THREE,St={int:0,float:0,vec2:Et?lt:null,vec3:Et?ft:null,vec4:Et?a.Vector4:null,mat2:null,mat3:Et?gt:null,mat4:Et?xt:null,sampler2D:0,samplerCube:0},Tt={int:"i",float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat2:"m2",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};At.type=function(t,e,n,r,s,i){const o={in:At.in,out:At.out,inout:At.inout};let a=Tt[e];n&&(a+="v");let h=St[e];(null!=h?h.call:void 0)&&(h=new h),n&&(h=[h]);const u=null!=o[s]?o[s]:o.in;i={const:"const"}[i];const l=At.param(s,i,e,n,r);return new jt(t,a,e,l,h,u)};class jt{constructor(t,e,n,r,s,i,o){this.name=t,this.type=e,this.spec=n,this.param=r,this.value=s,this.inout=i,this.meta=o}split(){const t=null!=this.meta.shadowed,e=t?"in":"out",n=t?At.in:At.out,r=this.param.split(e);return new jt(this.name,this.type,this.spec,r,this.value,n)}copy(t,e){return new jt(null!=t?t:this.name,this.type,this.spec,this.param,this.value,this.inout,e)}}const Dt="_i_o",Ft="return";let Pt=!1;const Vt=function(t,e){const n=Ot(t,e);return qt(n,e)};var Ot=function(t,e){let n,r,s=[];Pt&&(r=Bt());try{const t=at()(e);n=ut()(t)}catch(t){s=[{message:t}]}Pt&&r("GLSL Tokenize & Parse");const i=function(t){const e=(""+(t=t.split("\n")).length).length;return t.map(((t,n)=>{return`${r=n+1,(r=""+r).length<e?("       "+r).slice(-e):r}: ${t}`;var r})).join("\n")};if(!n||s.length){t||(t="(inline code)"),console.warn(i(e));for(let e of s)console.error(`${t} -`,e.message);throw new Error("GLSL parse error")}return n},qt=function(t,e){let n;Pt&&(n=Bt());const r=[];Ut(Lt,It(r),t,"");const[s,i,o]=Array.from(Rt(r)),a=$t(s,i,o);return Pt&&n("GLSL AST"),{ast:t,code:e,signatures:a}},Lt=function(t,e){switch(t.type){case"decl":return e(At.node(t)),!1}return!0};const It=t=>function(e){null!=e&&Array.from(e).map((e=>t.push(e)))};var Rt=function(t){let e=null;const n=[];let r=[];const s={};let i=!1;for(var o of Array.from(t))o.body?(s[o.ident]&&(r=Array.from(r).filter((t=>t.ident!==o.ident)),delete s[o.ident]),n.push(o),"main"===o.ident?(e=o,i=!0):i||(e=o)):"global"===o.storage?n.push(o):(r.push(o),s[o.ident]=!0);return[e,n,r]},$t=function(t,e,n){let r;const s={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},i=t=>At.type(t.ident,t.type,t.quant,t.count,t.inout,t.storage),o=function(t,e){let n;const r=Array.from(t.args).map((t=>i(t)));for(n of Array.from(r))if(n.inout===At.inout){const t=n,e=n.copy();t.inout=At.in,e.inout=At.out,e.meta={shadow:t.name},e.name+=Dt,t.meta={shadowed:e.name},r.push(e)}"void"!==t.type&&r.unshift(At.type(Ft,t.type,!1,"","out"));const s=`(${(()=>{const t=[];for(n of Array.from(r))n.inout===At.in&&t.push(n.type);return t})().join(",")})(${(()=>{const t=[];for(n of Array.from(r))n.inout===At.out&&t.push(n.type);return t})().join(",")})`;return{name:t.ident,type:s,signature:r,inout:e,spec:t.type}};for(r of(s.main=o(t,At.out),Array.from(e)))s.internal.push({name:r.ident});for(r of Array.from(n))switch(r.decl){case"external":var a=i(r);s[r.storage].push(a);break;case"function":a=o(r,At.in),s.external.push(a)}return s};Pt=!1;var Ut=function(t,e,n,r){Pt&&console.log(r,n.type,null!=n.token?n.token.data:void 0,null!=n.token?n.token.type:void 0);if(t(n,e))for(let s=0;s<n.children.length;s++){const i=n.children[s];Ut(t,e,i,r+"  ",Pt)}return null},Bt=function(){const t=+new Date;return function(e){const n=+new Date-t;return console.log(e,n+" ms"),n}};function Nt(t){const e=t.replace(Dt,"");return e!==t?e:null}function Ht(t){return t.join("\n")}function Xt(t){return t.join(", ")}function Zt(t){return t.join(";\n")}function Gt(t){return{entry:t,type:"void",params:[],signature:[],return:"",vars:{},calls:[],post:[],chain:{}}}function Qt(t,e){return`#define ${t} ${e}`}function Yt(t,e,n,r,s){return`${t} ${e}(${n}) {\n${r}${s}}`}function Wt(t,e,n){return`  ${t=t?`${t} = `:""}${e}(${n=Xt(n)})`}function Jt(t,e){for(let n=0;n<t.length;n++){const r=t[n],s=e[n];if(!s)return!1;if(r.type!==s.type)return!1;if(r.name===Ft!=(s.name===Ft))return!1}return!0}function Kt(t,e,n,r,s){const i=[];let o="";for(let n of Array.from(r)){var a,h;const{name:r}=n;let u=a=t(r),l=null,c=null,p=!1;const{inout:d}=n,f=r===Ft;if((h=null!=n.meta?n.meta.shadowed:void 0)&&(l=t(h),l&&(s.vars[l]="  "+n.param(l),s.calls.push(`  ${l} = ${a}`),e(h)?c={shadowed:l}:n=n.split())),(h=null!=n.meta?n.meta.shadow:void 0)&&(l=t(h),l)){if(e(h)){c={shadow:l};continue}n=n.split(),p=!0}if(f?o=a:p||i.push(null!=l?l:a),e(r)){let t="push";f?""===s.return?(t="unshift",u=r,s.type=n.spec,s.return=`  return ${a}`,s.vars[a]="  "+n.param(a)):(s.vars[a]="  "+n.param(a),s.params.push(n.param(a,!0))):s.params.push(n.param(a,!0)),n=n.copy(u,c),s.signature[t](n)}else s.vars[a]="  "+n.param(a)}return s.calls.push(Wt(o,n,i))}function te(t,e){const{entry:n}=t;let r=null;if(e&&1===e.length&&"main"!==n){const s=e[0].module;Jt(t.signature,s.main.signature)&&(r=Qt(n,s.entry))}if(null==r){let s=(()=>{const e=[];for(let n in t.vars){const r=t.vars[n];e.push(r)}return e})();({calls:e}=t);const{post:i}=t;let{params:o}=t;const{type:a}=t,h=t.return;e=e.concat(i),""!==h&&e.push(h),e.push(""),s.length?(s.push(""),s=Zt(s)+"\n"):s="",e=Zt(e),o=Xt(o),r=Yt(a,n,o,s,e)}return{signature:t.signature,code:r,name:n}}function ee(t){const e={defs:[],bodies:[]};for(let n of Array.from(t))ne(n,e);return e.defs=Ht(e.defs),e.bodies=Zt(e.bodies),""===e.defs&&delete e.defs,""===e.bodies&&delete e.bodies,e}const ne=(t,e)=>{let n,r;const{module:s,name:i,external:o}=t,{main:a}=s,{entry:h}=s;if(Jt(a.signature,o.signature))return e.defs.push(Qt(i,h));const u=[],l=[];let c={};const d=[s.namespace,Ft].join("");for(n of Array.from(o.signature))r=n.inout===p?u:l,r.push(n);for(n of Array.from(a.signature)){r=n.inout===p?u:l;let t=r.shift().name;t===Ft&&(t=d),c[n.name]=t}let f=t=>c[t];const m=()=>!0,y=Gt();Kt(f,m,h,a.signature,y),y.entry=h,c={return:d},f=t=>null!=c[t]?c[t]:t;const g=Gt();Kt(f,m,h,o.signature,g);return g.calls=y.calls,g.entry=i,e.bodies.push(te(y).code.split(" {")[0]),e.bodies.push(te(g).code)};function re(t){const e=/([A-Za-z0-9_]+\s+)?[A-Za-z0-9_]+\s+[A-Za-z0-9_]+\s*\([^)]*\)\s*;\s*/gm,n=t=>t.replace(e,(t=>"")),r=t.split(/(?=[{}])/g);let s=0;for(let t=0;t<r.length;t++){const e=r[t];switch(e[0]){case"{":s++;break;case"}":s--}if(0===s){const s=e.split(/^[ \t]*#/m);for(let t=0;t<s.length;t++){let e=s[t];if(t>0){e=e.split(/\n/);const r=e.shift(),i=e.join("\n");s[t]=[r,n(i)].join("\n")}else s[t]=n(e)}r[t]=s.join("#")}}return r.join("")}function se(t){const e={};return t.replace(/((attribute|uniform|varying)\s+)[A-Za-z0-9_]+\s+([A-Za-z0-9_]+)\s*(\[[^\]]*\]\s*)?;\s*/gm,(function(t,n,r,s,i){return e[s]?"":(e[s]=!0,t)}))}function ie(t){const e=function(t,e){const n=[],r=[];for(let s of Array.from(t)){(s.match(e)?n:r).push(s)}return n.concat(r)};let n=t.split("\n");return n=e(n,/^#define ([^ ]+ _pg_[0-9]+_|_pg_[0-9]+_ [^ ]+)$/),n=e(n,/^#extension/),n.join("\n")}const{library:oe,cache:ae}=o,{visualize:he,inspect:ue}=i,{Snippet:le}=e,ce=function(t,e={}){const n={};for(let r in t)n[r]=e[r]||t[r];return n};class pe{constructor(t,e){if(!(this instanceof pe))return new pe(t,e);this.config=ce({globalUniforms:!1,globalVaryings:!0,globalAttributes:!0,globals:[],autoInspect:!1},e),this.fetch=ae(oe(h,t,le.load))}shader(t){null==t&&(t={});const e=ce(this.config,t);return new W(h,this.fetch,e)}material(t){return new K(this.shader(t),this.shader(t))}inspect(t){return pe.inspect(t)}visualize(t){return pe.visualize(t)}static inspect(t){return ue(t)}static visualize(t){return he(t)}}function de(t,e={}){return new pe(t,e)}pe.Block=b,pe.Factory=o,pe.GLSL=h,pe.Graph=t,pe.Linker=e,pe.Visualize=i})(),r})()}));
//# sourceMappingURL=shadergraph.min.js.map